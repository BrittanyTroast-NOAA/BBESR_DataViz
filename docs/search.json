[
  {
    "objectID": "Sep_Doc.html",
    "href": "Sep_Doc.html",
    "title": "Sep_Doc",
    "section": "",
    "text": "#| standalone: true\n#| viewerHeight: 600\nlibrary(shiny)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(plotly)\n# library(png)\nlibrary(gt)\nlibrary(shinythemes)\nlibrary(cowplot)\nlibrary(gtExtras)  \nlibrary(bslib)\n\n#####FUNCTION#####\n\nplot_fn_obj&lt;-function(df_obj) {\n  \n  \n  if (ncol(df_obj$data)&lt;5.5){\n    #single plot\n    plot_main&lt;-ggplot(data=df_obj$data, aes(x=year, y=value))+\n      geom_ribbon(data=df_obj$pos, aes(group=1,ymax=max, ymin=df_obj$vals$mean),fill=\"#7FFF7F\")+\n      geom_ribbon(data=df_obj$neg, aes(group=1,ymax=df_obj$vals$mean, ymin=min), fill=\"#FF7F7F\")+\n      geom_rect(aes(xmin=min(df_obj$data$year),xmax=max(df_obj$data$year),ymin=df_obj$vals$mean-df_obj$vals$sd, ymax=df_obj$vals$mean+df_obj$vals$sd), fill=\"white\")+\n      geom_hline(yintercept=df_obj$vals$mean, lty=\"dashed\")+\n      geom_hline(yintercept=df_obj$vals$mean+df_obj$vals$sd)+\n      geom_hline(yintercept=df_obj$vals$mean-df_obj$vals$sd)+\n      geom_line(aes(group=1), lwd=1)+\n      labs(x=\"Year\", y=df_obj$labs[2,2], title = df_obj$labs[1,2])+\n      theme_bw() + theme(title = element_text(size=14, face = \"bold\"))\n    \n    if (max(df_obj$data$year)-min(df_obj$data$year)&gt;20) {\n      plot_main&lt;-plot_main+scale_x_continuous(breaks = seq(min(df_obj$data$year),max(df_obj$data$year),5))\n    } else {\n      plot_main&lt;-plot_main+scale_x_continuous(breaks = seq(min(df_obj$data$year),max(df_obj$data$year),2))\n    }\n    plot_main\n    \n  } else {\n    #facet plot\n    \n    plot_sec&lt;-ggplot(data=df_obj$data, aes(x=year, y=value))+\n      facet_wrap(~subnm, ncol=1, scales = \"free_y\")+\n      geom_ribbon(data=df_obj$pos, aes(group=subnm,ymax=max, ymin=mean),fill=\"#7FFF7F\")+\n      geom_ribbon(data=df_obj$neg, aes(group=subnm,ymax=mean, ymin=min), fill=\"#FF7F7F\")+\n      geom_rect(data=merge(df_obj$data,df_obj$vals), aes(xmin=allminyear,xmax=allmaxyear,ymin=mean-sd, ymax=mean+sd), fill=\"white\")+\n      geom_hline(aes(yintercept=mean), lty=\"dashed\",data=df_obj$vals)+\n      geom_hline(aes(yintercept=mean+sd),data=df_obj$vals)+\n      geom_hline(aes(yintercept=mean-sd),data=df_obj$vals)+\n      geom_line(aes(group=1), lwd=0.75)+\n      labs(x=\"Year\", y=df_obj$labs[2,2], title = df_obj$labs[1,2])+\n      theme_bw()+theme(strip.background = element_blank(),\n                       strip.text = element_text(face=\"bold\"),\n                       title = element_text(size=14, face = \"bold\"))\n    \n    if (max(df_obj$data$year)-min(df_obj$data$year)&gt;20) {\n      plot_sec&lt;-plot_sec+scale_x_continuous(breaks = seq(min(df_obj$data$year),max(df_obj$data$year),5))\n    } else {\n      # plot_sec&lt;-plot_sec+scale_x_continuous(breaks = seq(min(df_obj$data$year),max(df_obj$data$year),2))\n    }\n    plot_sec\n    \n  }\n}\n\n\n#####Data Names#####\ndat_shrt_nms&lt;-c(\n  oilsp=\"Oil Spills\",\n  nav\"Nuisance Aquatic Vegetation\",\n  rdrum=\"Red Drum\",\n  blcrab=\"Blue Crab Catch\",\n  brpeli=\"Brown Pelican\",\n  oystercat=\"Oyster Catch\",\n  persmbusi=\"Percent Small Business\",\n  vesfish=\"Vessels Fishing & Seafood Dealers\"\n)\n\n#####UI#####\nui &lt;- navbarPage(\n  title = \"Barataria Basin ESR Tool\",\n  theme = shinytheme('flatly'),\n  \n  #Main Page\n  tabPanel(\n    title= \"Explore Indicators\",\n    \n    sidebarLayout(\n\n      sidebarPanel(h1(\"Data Selection\" , style = \"font-size:34px;\n                                                    text-align: center;\"), width = 4,\n                   selectInput(\"data\", label = h2(\"Choose Indicator:\", style = \"font-size:22px;\"), choices = c(\"Oil Spills\",\"Nuisance Aquatic Vegetation\",\"Red Drum\", \"Blue Crab Catch\",\"Brown Pelican\", \"Oyster Catch\",\"Percent Small Business\", \"Vessels Fishing & Seafood Dealers\")),\n                   tags$style(\".selectize-input {font-size: 18px}\"),\n                   tags$a(href=\"https://forms.gle/6ZWFZQuXUnDrfnqn9\", \"BB ESR Indicator Feedback Form\", style=\"font-size:26px;text-algin=center; margin-top: 50px; margin-left: 25px; text-align: center; font-weight:bold;\"),\n                   ),\n      ),\n      \n      \n      #####Main#####\n      mainPanel(plotlyOutput(\"plot\", height = \"500px\"),\n                # htmlOutput(\"time_range\"),\n                # tags$style(\"#time_range {font-size: 20px;\n                #                             margin-bottom: 0px;\n                #                             margin-top: -5px;}\"),\n                # gt_output(\"gt_table\"),\n                # htmlOutput(\"plain_header\"),\n                # htmlOutput(\"plain_text\"),\n                # tags$style(\"#plain_text {font-size:20px;\n                #                             margin-bottom: 25px;\n                #                             margin-top: 15px;}\"),\n                # tags$style(\"#plain_header {font-size:24px;\n                #                             margin-top: 25px;}\"),\n                \n      )\n    )),\n\n)\n\n#####Server#####\nserver &lt;- function(input, output) {\n  \n  #####Load Data Separately#####\n  get_data &lt;- reactive({\n  filename &lt;- paste0(dat_shrt_nms[input$data], \"_li.rds\")\n  get(load(filename))\n})\n  \n  #####Main plot#####\n  output$plot&lt;-renderPlotly({\n    df_pick &lt;- get_data()\n    plot_main&lt;-plot_fn(df_pick)\n    plotly_gg&lt;-ggplotly(plot_main)\n    df_cond&lt;-select(df_pick$data, -c(\"valence\",\"min\",\"max\"))\n    plotly_gg %&gt;%\n      rangeslider(start = min(df_cond$year), end = max(df_cond$year))\n    \n  })\n  \n  # ###View data table###\n  # output$df_view&lt;-renderTable({\n  #       df_pick &lt;- switch(input$data, \"Nuisance Aquatic Vegetation\"=nav,\"Oil Spills\"=oilsp, \"Red Drum\"=drum, \"Blue Crab Catch\"=blucrabcat,\"Brown Pelican\"=brownpeli, \"Oyster Catch\"=oystercat,\"Percent Small Business\"=persmallbusi,\"Vessels Fishing & Seafood Dealers\"=vesfish)\n  #   df_dat&lt;-df_dat_fn(df_pick)\n  #   \n  #   df_dat&lt;-df_dat_fn(df_pick)\n  #   pos&lt;-pos_fn(df_dat)\n  #   neg&lt;-neg_fn(df_dat)\n  #   val_df&lt;-val_fn(df_dat)\n  #   \n  # })\n  \n  # #####Text Time Selected#####\n  # output$time_range&lt;- renderText({\n  #       df_pick &lt;- switch(input$data, \"Nuisance Aquatic Vegetation\"=nav,\"Oil Spills\"=oilsp, \"Red Drum\"=drum, \"Blue Crab Catch\"=blucrabcat,\"Brown Pelican\"=brownpeli, \"Oyster Catch\"=oystercat,\"Percent Small Business\"=persmallbusi,\"Vessels Fishing & Seafood Dealers\"=vesfish)\n  #   selected_data &lt;- event_data(\"plotly_relayout\")\n  #   df_dat&lt;-df_dat_fn(df_pick)\n  #   sel_dat&lt;-df_dat[df_dat$year&gt;selected_data$xaxis.range[1] & df_dat$year&lt; selected_data$xaxis.range[2],]\n  #   \n  #   if (nrow(sel_dat)&gt;0) {\n  #     range&lt;-range(sel_dat$year)\n  #     paste0(\"&lt;b&gt;Time Frame=\",range[1],\"-\",range[2],\"&lt;/b&gt;\")\n  #   } else  {\n  #     range&lt;-range(df_dat$year)\n  #     paste0(\"&lt;b&gt;Time Frame=\",range[1],\"-\",range[2],\"&lt;/b&gt;\")\n  #   }\n  #   \n  #   \n  # })\n  # \n \n  #  #####Table#####\n  # output$gt_table&lt;- render_gt({\n  #       df_pick &lt;- switch(input$data, \"Nuisance Aquatic Vegetation\"=nav,\"Oil Spills\"=oilsp, \"Red Drum\"=drum, \"Blue Crab Catch\"=blucrabcat,\"Brown Pelican\"=brownpeli, \"Oyster Catch\"=oystercat,\"Percent Small Business\"=persmallbusi,\"Vessels Fishing & Seafood Dealers\"=vesfish)\n  #   selected_data &lt;- event_data(\"plotly_relayout\")\n  #   df_dat&lt;-df_dat_fn(df_pick)\n  #   val_df&lt;-val_fn(df_dat)\n  #   \n  #   sel_dat&lt;-df_dat[df_dat$year&gt;selected_data$xaxis.range[1] & df_dat$year&lt; selected_data$xaxis.range[2],]\n  #   \n  #   if (nrow(sel_dat)&gt;3) {\n  #     if (ncol(df_dat)&lt;5.5) {\n  #       #Mean Trend\n  #       sel_dat_mean&lt;-mean(sel_dat$value) # mean value last 5 years\n  #       mean_sel&lt;-if_else(sel_dat_mean&gt;val_df$mean+val_df$sd, \"+\", if_else(sel_dat_mean&lt;val_df$mean-val_df$sd, \"-\",\"●\")) #qualify mean trend\n  #       \n  #       #Slope Trend\n  #       lmout&lt;-summary(lm(sel_dat$value~sel_dat$year))\n  #       sel_slope&lt;-coef(lmout)[2,1] * length(unique(sel_dat$year)) #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n  #       slope_sel&lt;-if_else(sel_slope&gt;val_df$sd, \"↑\", if_else(sel_slope&lt; c(-val_df$sd), \"↓\",\"→\"))\n  #       \n  #       ###Table stuff\n  #       new_table&lt;-data.frame(val=c(round(val_df$mean,2), round(val_df$sd,2), val_df$mean_sym, val_df$slope_sym, mean_sel, slope_sel),\n  #                             metric=c(\"Historical_Mean\",\"Historical_SD\",\"Last 5_Mean\", \"Last 5_Slope\",\"Selected_Mean\", \"Selected_Slope\"))\n  #       \n  #       new_table &lt;- new_table %&gt;% pivot_wider(names_from = metric, values_from = val)\n  #       \n  #       gt(new_table) %&gt;%\n  #         tab_spanner_delim(delim = \"_\") %&gt;%\n  #         tab_stubhead(label = \"Sub Indicator\") %&gt;% \n  #         tab_header(title = \"Trends in Mean & Slope\") %&gt;%\n  #         tab_options(table.border.top.color = \"#3498db\",\n  #                     table.border.bottom.color = \"#3498db\",\n  #                     table.border.left.color = \"#3498db\",\n  #                     table.border.right.color = \"#3498db\",\n  #                     table.border.top.width = 5,\n  #                     table.border.bottom.width = 5,\n  #                     table.border.left.width = 5,\n  #                     table.border.right.width = 5,\n  #                     table.border.left.style = \"solid\",\n  #                     table.border.right.style = \"solid\",) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_body()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stubhead()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stub()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_column_labels()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_column_spanners()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(24), color=\"#3498db\", weight = \"bold\"),locations = cells_title())\n  #     } else {\n  #       #Selected Multi Sub\n  #       \n  #       sub_list&lt;-list()\n  #       subs&lt;-unique(df_dat$subnm)\n  #       for (i in 1:length(subs)){\n  #         sub_df&lt;-sel_dat[sel_dat$subnm==subs[i],]\n  #         vals&lt;-val_df[val_df$subnm==subs[i],]\n  #         sub_dat_mean&lt;-mean(sub_df$value) # mean value last 5 years\n  #         mean_sub&lt;-if_else(sub_dat_mean&gt;vals$mean+vals$sd, \"+\", if_else(sub_dat_mean&lt;vals$mean-vals$sd, \"-\",\"●\")) #qualify mean trend\n  #         \n  #         #Slope Trend\n  #         lmout&lt;-summary(lm(sub_df$value~sub_df$year))\n  #         sub_slope&lt;-coef(lmout)[2,1] * length(unique(sub_df$year)) #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n  #         slope_sub&lt;-if_else(sub_slope&gt;vals$sd, \"↑\", if_else(sub_slope&lt; c(-vals$sd), \"↓\",\"→\"))\n  #         \n  #         add_sub&lt;-data.frame(mean_sel=mean_sub,\n  #                             slope_sel=slope_sub)\n  #         sub_list[[i]]&lt;-add_sub\n  #         \n  #       }\n  #       \n  #       add_sel_df&lt;-do.call(\"rbind\",sub_list)\n  #       val_df&lt;-cbind(val_df, add_sel_df)\n  #       \n  #       val_df$mean&lt;-as.character(val_df$mean)\n  #       val_df$sd&lt;-as.character(val_df$sd)\n  #       \n  #       new_table&lt;-val_df %&gt;% select(\"Sub_Indicator\"=subnm,\"Historical_Mean\"=mean, \"Historical_SD\"=sd, \"Last 5_Mean\"=mean_sym, \"Last 5_Slope\"=slope_sym, \"Selected_Mean\"=mean_sel, \"Selected_Slope\"=slope_sel) %&gt;% \n  #         group_by(Sub_Indicator) %&gt;% pivot_longer(cols = -c(\"Sub_Indicator\"))\n  #       \n  #       \n  #       new_table &lt;- new_table %&gt;% pivot_wider(names_from = name, values_from = value)\n  #       new_table[,2:3]&lt;-lapply(new_table[,2:3], function(x) {round(as.numeric(x),2)})\n  #       rownames(new_table)&lt;-new_table$Sub_Indicator\n  #       \n  #       gt(new_table, rowname_col = \"Sub_Indicator\", groupname_col = NA) %&gt;%\n  #         tab_spanner_delim(delim = \"_\") %&gt;%\n  #         tab_stubhead(label = \"Sub Indicator\") %&gt;% \n  #         tab_header(title = \"Trends in Mean & Slope\") %&gt;%\n  #         tab_options(table.border.top.color = \"#3498db\",\n  #                     table.border.bottom.color = \"#3498db\",\n  #                     table.border.left.color = \"#3498db\",\n  #                     table.border.right.color = \"#3498db\",\n  #                     table.border.top.width = 5,\n  #                     table.border.bottom.width = 5,\n  #                     table.border.left.width = 5,\n  #                     table.border.right.width = 5,\n  #                     table.border.left.style = \"solid\",\n  #                     table.border.right.style = \"solid\",) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_body()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stubhead()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stub()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_column_labels()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_column_spanners()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(24), color=\"#3498db\", weight = \"bold\"),locations = cells_title())\n  #     }\n  #     \n  #     \n  #   } else {\n  #     \n  #     ###Table stuff\n  #     if (ncol(df_dat)&lt;5.5) {\n  #       new_table&lt;-data.frame(val=c(round(val_df$mean,2), round(val_df$sd,2), val_df$mean_sym, val_df$slope_sym),\n  #                             metric=c(\"Historical_Mean\",\"Historical_SD\",\"Last 5_Mean\", \"Last 5_Slope\"))\n  #       \n  #       new_table &lt;- new_table %&gt;% pivot_wider(names_from = metric, values_from = val)\n  #       \n  #       gt(new_table) %&gt;%\n  #         tab_spanner_delim(delim = \"_\") %&gt;%\n  #         tab_stubhead(label = \"Sub Indicator\") %&gt;% \n  #         tab_header(title = \"Trends in Mean & Slope\") %&gt;%\n  #         tab_options(table.border.top.color = \"#3498db\",\n  #                     table.border.bottom.color = \"#3498db\",\n  #                     table.border.left.color = \"#3498db\",\n  #                     table.border.right.color = \"#3498db\",\n  #                     table.border.top.width = 5,\n  #                     table.border.bottom.width = 5,\n  #                     table.border.left.width = 5,\n  #                     table.border.right.width = 5,\n  #                     table.border.left.style = \"solid\",\n  #                     table.border.right.style = \"solid\",) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_body()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stubhead()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stub()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_column_labels()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_column_spanners()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(24), color=\"#3498db\", weight = \"bold\"),locations = cells_title())\n  #       \n  #     } else {\n  #       val_df$mean&lt;-as.character(val_df$mean)\n  #       val_df$sd&lt;-as.character(val_df$sd)\n  #       \n  #       new_table&lt;-val_df %&gt;% select(\"Sub_Indicator\"=subnm,\"Historical_Mean\"=mean, \"Historical_SD\"=sd, \"Last 5_Mean\"=mean_sym, \"Last 5_Slope\"=slope_sym) %&gt;% \n  #         group_by(Sub_Indicator) %&gt;% pivot_longer(cols = -c(\"Sub_Indicator\"))\n  #       \n  #       \n  #       new_table &lt;- new_table %&gt;% pivot_wider(names_from = name, values_from = value)\n  #       new_table[,2:3]&lt;-lapply(new_table[,2:3], function(x) {round(as.numeric(x),2)})\n  #       rownames(new_table)&lt;-new_table$Sub_Indicator\n  #       \n  #       gt(new_table, rowname_col = \"Sub_Indicator\", groupname_col = NA) %&gt;%\n  #         tab_spanner_delim(delim = \"_\") %&gt;%\n  #         tab_stubhead(label = \"Sub Indicator\") %&gt;% \n  #         tab_header(title = \"Trends in Mean & Slope\") %&gt;%\n  #         tab_options(table.border.top.color = \"#3498db\",\n  #                     table.border.bottom.color = \"#3498db\",\n  #                     table.border.left.color = \"#3498db\",\n  #                     table.border.right.color = \"#3498db\",\n  #                     table.border.top.width = 5,\n  #                     table.border.bottom.width = 5,\n  #                     table.border.left.width = 5,\n  #                     table.border.right.width = 5,\n  #                     table.border.left.style = \"solid\",\n  #                     table.border.right.style = \"solid\",) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_body()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stubhead()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stub()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_column_labels()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_column_spanners()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(24), color=\"#3498db\", weight = \"bold\"),locations = cells_title())\n  #       \n  #       \n  #       \n  #       \n  #       \n  #       \n  #       \n  #     }\n  #     \n  #   }\n  # })\n  # \n \n  #  #####Sel Trend Plot#####\n  # output$trend_plot&lt;- renderPlot({\n  #       df_pick &lt;- switch(input$data, \"Nuisance Aquatic Vegetation\"=nav,\"Oil Spills\"=oilsp, \"Red Drum\"=drum, \"Blue Crab Catch\"=blucrabcat,\"Brown Pelican\"=brownpeli, \"Oyster Catch\"=oystercat,\"Percent Small Business\"=persmallbusi,\"Vessels Fishing & Seafood Dealers\"=vesfish)\n  #   df_dat&lt;-df_dat_fn(df_pick)\n  #   val_df&lt;-val_df(df_dat)\n  #   selected_data &lt;- event_data(\"plotly_relayout\")\n  #   sel_dat&lt;-df_dat[df_dat$year&gt;selected_data$xaxis.range[1] & df_dat$year&lt; selected_data$xaxis.range[2],]\n  #   \n  #   \n  #   if(nrow(sel_dat)&gt;3) {\n  #     \n  #     #Mean Trend\n  #     sel_dat_mean&lt;-mean(sel_dat$value) # mean value last 5 years\n  #     mean_tr_sel&lt;-if_else(sel_dat_mean&gt;val_df$mean+val_df$sd, \"ptPlus\", if_else(sel_dat_mean&lt;val_df$mean-val_df$sd, \"ptMinus\",\"ptSolid\")) #qualify mean trend\n  #     \n  #     #Slope Trend\n  #     lmout&lt;-summary(lm(sel_dat$value~sel_dat$year))\n  #     sel_slope&lt;-coef(lmout)[2,1] * length(unique(sel_dat$year)) #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n  #     slope_tr_sel&lt;-if_else(sel_slope&gt;val_df$sd, \"arrowUp\", if_else(sel_slope&lt; c(-val_df$sd), \"arrowDown\",\"arrowRight\"))\n  #     \n  #     range&lt;-range(sel_dat$year)\n  #     \n  #     plot_trend&lt;-testtrend_base+\n  #       draw_image(get(mean_tr_sel), scale=0.35, y=0.25)+\n  #       draw_image(get(slope_tr_sel), scale=0.35, y=-0.3)+\n  #       labs(title = paste0(\"Selected Years\\n(\",range[1],\"-\",range[2],\")\"))\n  #     \n  #     plot_trend\n  #   }\n  #   \n  # }, bg=\"transparent\")\n  # \n  # #####Last5 Trend Plot#####\n  # output$trendplot_last5&lt;- renderPlot({\n  #       df_pick &lt;- switch(input$data, \"Nuisance Aquatic Vegetation\"=nav,\"Oil Spills\"=oilsp, \"Red Drum\"=drum, \"Blue Crab Catch\"=blucrabcat,\"Brown Pelican\"=brownpeli, \"Oyster Catch\"=oystercat,\"Percent Small Business\"=persmallbusi,\"Vessels Fishing & Seafood Dealers\"=vesfish)\n  #   df_dat&lt;-df_dat_fn(df_pick)\n  #   val_df&lt;-val_fn(df_dat)\n  #   \n  #   testtrend_base+\n  #     draw_image(get(val_df$mean_tr), scale=0.35, y=0.25)+\n  #     draw_image(get(val_df$slope_tr), scale=0.35, y=-0.3)+\n  #     labs(title = \"Last Five Years\\nof Data\")\n  #   \n  # }, bg=\"transparent\")\n  # \n  # #####Plain Text#####\n  # output$plain_header&lt;- renderText({\n  #   plain_header&lt;-paste0(\"&lt;b&gt;&lt;u&gt;Summary&lt;/b&gt;&lt;/u&gt;\")\n  # })\n  # \n  # output$plain_text&lt;-renderText({\n  #       df_pick &lt;- switch(input$data, \"Nuisance Aquatic Vegetation\"=nav,\"Oil Spills\"=oilsp, \"Red Drum\"=drum, \"Blue Crab Catch\"=blucrabcat,\"Brown Pelican\"=brownpeli, \"Oyster Catch\"=oystercat,\"Percent Small Business\"=persmallbusi,\"Vessels Fishing & Seafood Dealers\"=vesfish)\n  #   df_dat&lt;-df_dat_fn(df_pick)\n  #   df_lab&lt;-df_pick[1:3, c(1:ncol(df_pick))] #For example sake cutting to only col I need\n  #   val_df&lt;-val_fn(df_dat)\n  #   selected_data &lt;- event_data(\"plotly_relayout\")\n  #   sel_dat&lt;-df_dat[df_dat$year&gt;selected_data$xaxis.range[1] & df_dat$year&lt; selected_data$xaxis.range[2],]\n  #   \n  #   if (nrow(sel_dat)&lt;3) {\n  #     ###Not selected no subs\n  #     if (ncol(df_dat)&lt;5.5) {\n  #       text&lt;-paste0(\"The &lt;b&gt;\",df_lab[1,2] ,\"&lt;/b&gt; indicator has a historical mean of &lt;u&gt;&lt;b&gt;\", round(val_df$mean[1],2),\"&lt;/u&gt;&lt;/b&gt; ±&lt;u&gt;&lt;b&gt;\",round(val_df$sd[1],2)  ,\"&lt;/u&gt;&lt;/b&gt; and trends for the last five years of data show mean values &lt;b&gt;&lt;u&gt;\",val_df$mean_word, \"&lt;/b&gt;&lt;/u&gt; 1 standard deviation from the historical mean and &lt;u&gt;&lt;b&gt;\",val_df$slope_word, \"&lt;/u&gt;&lt;/b&gt; trend in slope.\")\n  #     } else {\n  #       ###Not slected subs\n  #       val_df$mean&lt;-as.character(val_df$mean)\n  #       val_df$sd&lt;-as.character(val_df$sd)\n  #       \n  #       new_table&lt;-val_df %&gt;% select(subnm, mean,  sd,  mean_sym,  slope_sym) %&gt;% \n  #         group_by(subnm) %&gt;% pivot_longer(cols = -c(subnm))\n  #       \n  #       val_df$mean&lt;-as.numeric(val_df$mean)\n  #       val_df$sd&lt;-as.numeric(val_df$sd)\n  #       \n  #       \n  #       text&lt;-paste0(\"The &lt;b&gt;\",df_lab[1,2] ,\"&lt;/b&gt; indicator for the &lt;u&gt;&lt;b&gt;\", val_df$subnm[1],\"&lt;/u&gt;&lt;/b&gt; sub indicator has a historical mean of &lt;u&gt;&lt;b&gt;\", round(val_df$mean[1],2),\"&lt;/u&gt;&lt;/b&gt; ±&lt;u&gt;&lt;b&gt;\",round(val_df$sd[1],2)  ,\"&lt;/u&gt;&lt;/b&gt; and trends for the last five years of data show mean values &lt;b&gt;&lt;u&gt;\",val_df$mean_word[1], \"&lt;/b&gt;&lt;/u&gt; 1 standard deviation from the historical mean and &lt;u&gt;&lt;b&gt;\",val_df$slope_word[1], \"&lt;/u&gt;&lt;/b&gt; trend in slope.\")\n  #       \n  #       text_li&lt;-list()\n  #       for (i in 2:length(val_df$subnm)) {\n  #         subtext&lt;-paste0(\"The &lt;u&gt;&lt;b&gt;\",val_df$subnm[i], \"&lt;/u&gt;&lt;/b&gt; sub index historical mean is &lt;u&gt;&lt;b&gt;\",round(val_df$mean[i],2),\"&lt;/u&gt;&lt;/b&gt;±&lt;u&gt;&lt;b&gt;\",round(val_df$sd[i],2),\"&lt;/u&gt;&lt;/b&gt; and trends from the last five years of data show mean values&lt;u&gt;&lt;b&gt;\",val_df$mean_word[i],\"&lt;/u&gt;&lt;/b&gt; 1 standard deviation from the historical mean and &lt;u&gt;&lt;b&gt;\",val_df$slope_word[i], \"&lt;/u&gt;&lt;/b&gt; trend in slope.\") \n  #         text_li[[i]]&lt;-subtext\n  #       }\n  #       subs_text&lt;-do.call(\"paste\", text_li)\n  #       paste(text,subs_text)\n  #     }\n  #     \n  #     \n  #   } else {\n  #     if (ncol(df_dat)&lt;5.5) {\n  #       \n  #       #Selected no subs\n  #       #Mean Trend\n  #       sel_dat_mean&lt;-mean(sel_dat$value) # mean value last 5 years\n  #       mean_sel_word&lt;-if_else(sel_dat_mean&gt;val_df$mean+val_df$sd, \"greater\", if_else(sel_dat_mean&lt;val_df$mean-val_df$sd, \"below\",\"within\")) #qualify mean trend\n  #       \n  #       #Slope Trend\n  #       lmout&lt;-summary(lm(sel_dat$value~sel_dat$year))\n  #       sel_slope&lt;-coef(lmout)[2,1] * length(unique(sel_dat$year)) #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n  #       slope_sel_word&lt;-if_else(sel_slope&gt;val_df$sd, \"an increasing\", if_else(sel_slope&lt; c(-val_df$sd), \"a decreasing\",\"a stable\"))\n  #       \n  #       range&lt;-range(sel_dat$year)\n  #       \n  #       text&lt;-paste0(\"The &lt;b&gt;\",df_lab[1,2] ,\"&lt;/b&gt; indicator has a historical mean of &lt;u&gt;&lt;b&gt;\", round(val_df$mean[1],2),\"&lt;/u&gt;&lt;/b&gt; ±&lt;u&gt;&lt;b&gt;\",round(val_df$sd[1],2)  ,\"&lt;/u&gt;&lt;/b&gt; and trends for the last five years of data show mean values &lt;b&gt;&lt;u&gt;\",val_df$mean_word, \"&lt;/u&gt;&lt;/b&gt; 1 standard deviation from the historical mean and &lt;b&gt;&lt;u&gt;\",val_df$slope_word, \"&lt;/b&gt;&lt;/u&gt; trend in slope. The trends in the selected years of data &lt;b&gt;(\",range[1],\"-\",range[2],\")&lt;/b&gt; show mean values &lt;b&gt;&lt;u&gt;\", mean_sel_word,\"&lt;/b&gt;&lt;/u&gt; 1 standard deviation from the historical mean and &lt;b&gt;&lt;u&gt;\",slope_sel_word, \"&lt;/b&gt;&lt;/u&gt; trend in slope.\")\n  #       \n  #       \n  #     } else {\n  #       ###Selected w subs\n  #       sub_list&lt;-list()\n  #       subs&lt;-unique(df_dat$subnm)\n  #       for (i in 1:length(subs)){\n  #         sub_df&lt;-sel_dat[sel_dat$subnm==subs[i],]\n  #         vals&lt;-val_df[val_df$subnm==subs[i],]\n  #         sub_dat_mean&lt;-mean(sub_df$value) # mean value last 5 years\n  #         mean_sub&lt;-if_else(sub_dat_mean&gt;vals$mean+vals$sd, \"greater\", if_else(sub_dat_mean&lt;vals$mean-vals$sd, \"below\",\"within\")) #qualify mean trend\n  #         \n  #         #Slope Trend\n  #         lmout&lt;-summary(lm(sub_df$value~sub_df$year))\n  #         sub_slope&lt;-coef(lmout)[2,1] * length(unique(sub_df$year)) #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n  #         slope_sub&lt;-if_else(sub_slope&gt;vals$sd, \"an increasing\", if_else(sub_slope&lt; c(-vals$sd), \"a decreasing\",\"a stable\"))\n  #         \n  #         add_sub&lt;-data.frame(mean_sel=mean_sub,\n  #                             slope_sel=slope_sub)\n  #         sub_list[[i]]&lt;-add_sub\n  #         \n  #       }\n  #       add_sel_df&lt;-do.call(\"rbind\",sub_list)\n  #       val_df&lt;-cbind(val_df, add_sel_df)\n  #       \n  #       val_df$mean&lt;-as.character(val_df$mean)\n  #       val_df$sd&lt;-as.character(val_df$sd)\n  #       \n  #       val_df&lt;-val_df %&gt;% select(subnm,mean, sd, mean_word, slope_word, mean_sel, slope_sel)\n  #       val_df$mean&lt;-as.numeric(val_df$mean)\n  #       val_df$sd&lt;-as.numeric(val_df$sd)\n  #       \n  #       range&lt;-range(sel_dat$year)\n  #       \n  #       text&lt;-paste0(\"The &lt;b&gt;\",df_lab[1,2] ,\"&lt;/b&gt; indicator for the &lt;u&gt;&lt;b&gt;\", val_df$subnm[1],\"&lt;/u&gt;&lt;/b&gt; sub indicator has a historical mean of &lt;u&gt;&lt;b&gt;\", round(val_df$mean[1],2),\"&lt;/u&gt;&lt;/b&gt; ±&lt;u&gt;&lt;b&gt;\",round(val_df$sd[1],2)  ,\"&lt;/u&gt;&lt;/b&gt; and trends for the last five years of data show mean values &lt;b&gt;&lt;u&gt;\",val_df$mean_word[1], \"&lt;/b&gt;&lt;/u&gt; 1 standard deviation from the historical mean and &lt;u&gt;&lt;b&gt;\",val_df$slope_word[1], \"&lt;/u&gt;&lt;/b&gt; trend in slope. The trends in the selected years of data &lt;b&gt;(\",range[1],\"-\",range[2],\")&lt;/b&gt; show mean values &lt;b&gt;&lt;u&gt;\", val_df$mean_sel[1],\"&lt;/b&gt;&lt;/u&gt; 1 standard deviation from the historical mean and &lt;b&gt;&lt;u&gt;\",val_df$slope_sel[1], \"&lt;/b&gt;&lt;/u&gt; trend in slope.\")\n  #       \n  #       text_li&lt;-list()\n  #       for (i in 2:length(val_df$subnm)) {\n  #         subtext&lt;-paste0(\"The &lt;u&gt;&lt;b&gt;\",val_df$subnm[i], \"&lt;/u&gt;&lt;/b&gt; sub index historical mean is &lt;u&gt;&lt;b&gt;\",round(val_df$mean[i],2),\" &lt;/u&gt;&lt;/b&gt;±&lt;u&gt;&lt;b&gt;\",round(val_df$sd[i],2),\"&lt;/u&gt;&lt;/b&gt; and trends from the last five years of data show mean values &lt;u&gt;&lt;b&gt;\",val_df$mean_word[i],\"&lt;/u&gt;&lt;/b&gt; 1 standard deviation from the historical mean and &lt;u&gt;&lt;b&gt;\",val_df$slope_word[i], \"&lt;/u&gt;&lt;/b&gt; trend in slope. The trends in the selected years of data show mean values &lt;b&gt;&lt;u&gt;\", val_df$mean_sel[i],\"&lt;/b&gt;&lt;/u&gt; 1 standard deviation from the historical mean and &lt;b&gt;&lt;u&gt;\",val_df$slope_sel[i], \"&lt;/b&gt;&lt;/u&gt; trend in slope.\") \n  #         text_li[[i]]&lt;-subtext\n  #       }\n  #       subs_text&lt;-do.call(\"paste\", text_li)\n  #       paste(text,subs_text)\n  #       \n  #     }\n  #     \n  #     \n  #   }\n  # })\n  # \n\n  # #####STUFF FOR INFO PAGE#####\n  # #Help fig\n  # output$plotimg&lt;-renderImage({\n  #   list(src=\"WWW/TS_info.png\",\n  #        contentType=\"image/png\",\n  #        align=\"center\")\n  # }, deleteFile = F)\n  # \n  # #Text\n  # output$introtext&lt;-renderText({\n  #   \n  #   introtext&lt;-\"This app is intended to provide a way to interact with indicators from the Barataria Basin Ecosystem Status Report (ESR). The Barataria Basin ESR is a report with over 100 indicators describing drivers, pressures, states, human activities, and human dimensions produced by NOAA's Integrated Ecosystem Assessment (IEA) program. This is a prototype app with a small selection of indicators in order to get feedback for a potential future product.\"\n  # })\n  # \n  # output$usehead&lt;-renderText({\n  #   \n  #   infotext&lt;-\"How to Use\"\n  # })\n  # \n  # output$infotext1&lt;-renderText({\n  #   \n  #   infotext1&lt;-\"&lt;b&gt;1.&lt;/b&gt; Begin by choosing the indicator from the dropdown menu on the left of the screen. &lt;br&gt;&lt;br&gt;\n  #     &lt;b&gt;2&lt;/b&gt;. The indicator time series plot will be updated on the right. Below is a figure on how to interpret the plot.\"\n  # })\n  # \n  # output$infotext2&lt;-renderText({\n  #   \n  #   infotext2&lt;-\"&lt;b&gt;3.&lt;/b&gt; Below the plot is a rangeslider. Pull on either end of the slider to customize the time range of the plot. The time frame you have chosen will appear in text below the slider, originally indicating the full time frame of the indicator. &lt;br&gt;&lt;br&gt;\n  #     &lt;b&gt;4.&lt;/b&gt; A table below the figure show the historical mean and standard deviation (presented as dashed and solid black horizontal lines) and the trends in mean and slope compared to those values of the last five years of data as presented in the ESR. This table will update with trends of mean and slope if a custom time frame is selected using the rangeslider. &lt;br&gt;&lt;br&gt;\n  #     &lt;b&gt;5.&lt;/b&gt; Below the table is a plain text summary of the table above, describing mean and SD values as well as trends in mean and slope for the last five years of data and slected time frames.\" \n  # })\n  # \n}\n\n\n\n# Run the application \napp&lt;-shinyApp(ui = ui, server = server)"
  },
  {
    "objectID": "Sep_Doc.html#part-of-old-app",
    "href": "Sep_Doc.html#part-of-old-app",
    "title": "Sep_Doc",
    "section": "",
    "text": "#| standalone: true\n#| viewerHeight: 600\nlibrary(shiny)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(plotly)\n# library(png)\nlibrary(gt)\nlibrary(shinythemes)\nlibrary(cowplot)\nlibrary(gtExtras)  \nlibrary(bslib)\n\n#####FUNCTION#####\n\nplot_fn_obj&lt;-function(df_obj) {\n  \n  \n  if (ncol(df_obj$data)&lt;5.5){\n    #single plot\n    plot_main&lt;-ggplot(data=df_obj$data, aes(x=year, y=value))+\n      geom_ribbon(data=df_obj$pos, aes(group=1,ymax=max, ymin=df_obj$vals$mean),fill=\"#7FFF7F\")+\n      geom_ribbon(data=df_obj$neg, aes(group=1,ymax=df_obj$vals$mean, ymin=min), fill=\"#FF7F7F\")+\n      geom_rect(aes(xmin=min(df_obj$data$year),xmax=max(df_obj$data$year),ymin=df_obj$vals$mean-df_obj$vals$sd, ymax=df_obj$vals$mean+df_obj$vals$sd), fill=\"white\")+\n      geom_hline(yintercept=df_obj$vals$mean, lty=\"dashed\")+\n      geom_hline(yintercept=df_obj$vals$mean+df_obj$vals$sd)+\n      geom_hline(yintercept=df_obj$vals$mean-df_obj$vals$sd)+\n      geom_line(aes(group=1), lwd=1)+\n      labs(x=\"Year\", y=df_obj$labs[2,2], title = df_obj$labs[1,2])+\n      theme_bw() + theme(title = element_text(size=14, face = \"bold\"))\n    \n    if (max(df_obj$data$year)-min(df_obj$data$year)&gt;20) {\n      plot_main&lt;-plot_main+scale_x_continuous(breaks = seq(min(df_obj$data$year),max(df_obj$data$year),5))\n    } else {\n      plot_main&lt;-plot_main+scale_x_continuous(breaks = seq(min(df_obj$data$year),max(df_obj$data$year),2))\n    }\n    plot_main\n    \n  } else {\n    #facet plot\n    \n    plot_sec&lt;-ggplot(data=df_obj$data, aes(x=year, y=value))+\n      facet_wrap(~subnm, ncol=1, scales = \"free_y\")+\n      geom_ribbon(data=df_obj$pos, aes(group=subnm,ymax=max, ymin=mean),fill=\"#7FFF7F\")+\n      geom_ribbon(data=df_obj$neg, aes(group=subnm,ymax=mean, ymin=min), fill=\"#FF7F7F\")+\n      geom_rect(data=merge(df_obj$data,df_obj$vals), aes(xmin=allminyear,xmax=allmaxyear,ymin=mean-sd, ymax=mean+sd), fill=\"white\")+\n      geom_hline(aes(yintercept=mean), lty=\"dashed\",data=df_obj$vals)+\n      geom_hline(aes(yintercept=mean+sd),data=df_obj$vals)+\n      geom_hline(aes(yintercept=mean-sd),data=df_obj$vals)+\n      geom_line(aes(group=1), lwd=0.75)+\n      labs(x=\"Year\", y=df_obj$labs[2,2], title = df_obj$labs[1,2])+\n      theme_bw()+theme(strip.background = element_blank(),\n                       strip.text = element_text(face=\"bold\"),\n                       title = element_text(size=14, face = \"bold\"))\n    \n    if (max(df_obj$data$year)-min(df_obj$data$year)&gt;20) {\n      plot_sec&lt;-plot_sec+scale_x_continuous(breaks = seq(min(df_obj$data$year),max(df_obj$data$year),5))\n    } else {\n      # plot_sec&lt;-plot_sec+scale_x_continuous(breaks = seq(min(df_obj$data$year),max(df_obj$data$year),2))\n    }\n    plot_sec\n    \n  }\n}\n\n\n#####Data Names#####\ndat_shrt_nms&lt;-c(\n  oilsp=\"Oil Spills\",\n  nav\"Nuisance Aquatic Vegetation\",\n  rdrum=\"Red Drum\",\n  blcrab=\"Blue Crab Catch\",\n  brpeli=\"Brown Pelican\",\n  oystercat=\"Oyster Catch\",\n  persmbusi=\"Percent Small Business\",\n  vesfish=\"Vessels Fishing & Seafood Dealers\"\n)\n\n#####UI#####\nui &lt;- navbarPage(\n  title = \"Barataria Basin ESR Tool\",\n  theme = shinytheme('flatly'),\n  \n  #Main Page\n  tabPanel(\n    title= \"Explore Indicators\",\n    \n    sidebarLayout(\n\n      sidebarPanel(h1(\"Data Selection\" , style = \"font-size:34px;\n                                                    text-align: center;\"), width = 4,\n                   selectInput(\"data\", label = h2(\"Choose Indicator:\", style = \"font-size:22px;\"), choices = c(\"Oil Spills\",\"Nuisance Aquatic Vegetation\",\"Red Drum\", \"Blue Crab Catch\",\"Brown Pelican\", \"Oyster Catch\",\"Percent Small Business\", \"Vessels Fishing & Seafood Dealers\")),\n                   tags$style(\".selectize-input {font-size: 18px}\"),\n                   tags$a(href=\"https://forms.gle/6ZWFZQuXUnDrfnqn9\", \"BB ESR Indicator Feedback Form\", style=\"font-size:26px;text-algin=center; margin-top: 50px; margin-left: 25px; text-align: center; font-weight:bold;\"),\n                   ),\n      ),\n      \n      \n      #####Main#####\n      mainPanel(plotlyOutput(\"plot\", height = \"500px\"),\n                # htmlOutput(\"time_range\"),\n                # tags$style(\"#time_range {font-size: 20px;\n                #                             margin-bottom: 0px;\n                #                             margin-top: -5px;}\"),\n                # gt_output(\"gt_table\"),\n                # htmlOutput(\"plain_header\"),\n                # htmlOutput(\"plain_text\"),\n                # tags$style(\"#plain_text {font-size:20px;\n                #                             margin-bottom: 25px;\n                #                             margin-top: 15px;}\"),\n                # tags$style(\"#plain_header {font-size:24px;\n                #                             margin-top: 25px;}\"),\n                \n      )\n    )),\n\n)\n\n#####Server#####\nserver &lt;- function(input, output) {\n  \n  #####Load Data Separately#####\n  get_data &lt;- reactive({\n  filename &lt;- paste0(dat_shrt_nms[input$data], \"_li.rds\")\n  get(load(filename))\n})\n  \n  #####Main plot#####\n  output$plot&lt;-renderPlotly({\n    df_pick &lt;- get_data()\n    plot_main&lt;-plot_fn(df_pick)\n    plotly_gg&lt;-ggplotly(plot_main)\n    df_cond&lt;-select(df_pick$data, -c(\"valence\",\"min\",\"max\"))\n    plotly_gg %&gt;%\n      rangeslider(start = min(df_cond$year), end = max(df_cond$year))\n    \n  })\n  \n  # ###View data table###\n  # output$df_view&lt;-renderTable({\n  #       df_pick &lt;- switch(input$data, \"Nuisance Aquatic Vegetation\"=nav,\"Oil Spills\"=oilsp, \"Red Drum\"=drum, \"Blue Crab Catch\"=blucrabcat,\"Brown Pelican\"=brownpeli, \"Oyster Catch\"=oystercat,\"Percent Small Business\"=persmallbusi,\"Vessels Fishing & Seafood Dealers\"=vesfish)\n  #   df_dat&lt;-df_dat_fn(df_pick)\n  #   \n  #   df_dat&lt;-df_dat_fn(df_pick)\n  #   pos&lt;-pos_fn(df_dat)\n  #   neg&lt;-neg_fn(df_dat)\n  #   val_df&lt;-val_fn(df_dat)\n  #   \n  # })\n  \n  # #####Text Time Selected#####\n  # output$time_range&lt;- renderText({\n  #       df_pick &lt;- switch(input$data, \"Nuisance Aquatic Vegetation\"=nav,\"Oil Spills\"=oilsp, \"Red Drum\"=drum, \"Blue Crab Catch\"=blucrabcat,\"Brown Pelican\"=brownpeli, \"Oyster Catch\"=oystercat,\"Percent Small Business\"=persmallbusi,\"Vessels Fishing & Seafood Dealers\"=vesfish)\n  #   selected_data &lt;- event_data(\"plotly_relayout\")\n  #   df_dat&lt;-df_dat_fn(df_pick)\n  #   sel_dat&lt;-df_dat[df_dat$year&gt;selected_data$xaxis.range[1] & df_dat$year&lt; selected_data$xaxis.range[2],]\n  #   \n  #   if (nrow(sel_dat)&gt;0) {\n  #     range&lt;-range(sel_dat$year)\n  #     paste0(\"&lt;b&gt;Time Frame=\",range[1],\"-\",range[2],\"&lt;/b&gt;\")\n  #   } else  {\n  #     range&lt;-range(df_dat$year)\n  #     paste0(\"&lt;b&gt;Time Frame=\",range[1],\"-\",range[2],\"&lt;/b&gt;\")\n  #   }\n  #   \n  #   \n  # })\n  # \n \n  #  #####Table#####\n  # output$gt_table&lt;- render_gt({\n  #       df_pick &lt;- switch(input$data, \"Nuisance Aquatic Vegetation\"=nav,\"Oil Spills\"=oilsp, \"Red Drum\"=drum, \"Blue Crab Catch\"=blucrabcat,\"Brown Pelican\"=brownpeli, \"Oyster Catch\"=oystercat,\"Percent Small Business\"=persmallbusi,\"Vessels Fishing & Seafood Dealers\"=vesfish)\n  #   selected_data &lt;- event_data(\"plotly_relayout\")\n  #   df_dat&lt;-df_dat_fn(df_pick)\n  #   val_df&lt;-val_fn(df_dat)\n  #   \n  #   sel_dat&lt;-df_dat[df_dat$year&gt;selected_data$xaxis.range[1] & df_dat$year&lt; selected_data$xaxis.range[2],]\n  #   \n  #   if (nrow(sel_dat)&gt;3) {\n  #     if (ncol(df_dat)&lt;5.5) {\n  #       #Mean Trend\n  #       sel_dat_mean&lt;-mean(sel_dat$value) # mean value last 5 years\n  #       mean_sel&lt;-if_else(sel_dat_mean&gt;val_df$mean+val_df$sd, \"+\", if_else(sel_dat_mean&lt;val_df$mean-val_df$sd, \"-\",\"●\")) #qualify mean trend\n  #       \n  #       #Slope Trend\n  #       lmout&lt;-summary(lm(sel_dat$value~sel_dat$year))\n  #       sel_slope&lt;-coef(lmout)[2,1] * length(unique(sel_dat$year)) #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n  #       slope_sel&lt;-if_else(sel_slope&gt;val_df$sd, \"↑\", if_else(sel_slope&lt; c(-val_df$sd), \"↓\",\"→\"))\n  #       \n  #       ###Table stuff\n  #       new_table&lt;-data.frame(val=c(round(val_df$mean,2), round(val_df$sd,2), val_df$mean_sym, val_df$slope_sym, mean_sel, slope_sel),\n  #                             metric=c(\"Historical_Mean\",\"Historical_SD\",\"Last 5_Mean\", \"Last 5_Slope\",\"Selected_Mean\", \"Selected_Slope\"))\n  #       \n  #       new_table &lt;- new_table %&gt;% pivot_wider(names_from = metric, values_from = val)\n  #       \n  #       gt(new_table) %&gt;%\n  #         tab_spanner_delim(delim = \"_\") %&gt;%\n  #         tab_stubhead(label = \"Sub Indicator\") %&gt;% \n  #         tab_header(title = \"Trends in Mean & Slope\") %&gt;%\n  #         tab_options(table.border.top.color = \"#3498db\",\n  #                     table.border.bottom.color = \"#3498db\",\n  #                     table.border.left.color = \"#3498db\",\n  #                     table.border.right.color = \"#3498db\",\n  #                     table.border.top.width = 5,\n  #                     table.border.bottom.width = 5,\n  #                     table.border.left.width = 5,\n  #                     table.border.right.width = 5,\n  #                     table.border.left.style = \"solid\",\n  #                     table.border.right.style = \"solid\",) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_body()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stubhead()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stub()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_column_labels()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_column_spanners()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(24), color=\"#3498db\", weight = \"bold\"),locations = cells_title())\n  #     } else {\n  #       #Selected Multi Sub\n  #       \n  #       sub_list&lt;-list()\n  #       subs&lt;-unique(df_dat$subnm)\n  #       for (i in 1:length(subs)){\n  #         sub_df&lt;-sel_dat[sel_dat$subnm==subs[i],]\n  #         vals&lt;-val_df[val_df$subnm==subs[i],]\n  #         sub_dat_mean&lt;-mean(sub_df$value) # mean value last 5 years\n  #         mean_sub&lt;-if_else(sub_dat_mean&gt;vals$mean+vals$sd, \"+\", if_else(sub_dat_mean&lt;vals$mean-vals$sd, \"-\",\"●\")) #qualify mean trend\n  #         \n  #         #Slope Trend\n  #         lmout&lt;-summary(lm(sub_df$value~sub_df$year))\n  #         sub_slope&lt;-coef(lmout)[2,1] * length(unique(sub_df$year)) #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n  #         slope_sub&lt;-if_else(sub_slope&gt;vals$sd, \"↑\", if_else(sub_slope&lt; c(-vals$sd), \"↓\",\"→\"))\n  #         \n  #         add_sub&lt;-data.frame(mean_sel=mean_sub,\n  #                             slope_sel=slope_sub)\n  #         sub_list[[i]]&lt;-add_sub\n  #         \n  #       }\n  #       \n  #       add_sel_df&lt;-do.call(\"rbind\",sub_list)\n  #       val_df&lt;-cbind(val_df, add_sel_df)\n  #       \n  #       val_df$mean&lt;-as.character(val_df$mean)\n  #       val_df$sd&lt;-as.character(val_df$sd)\n  #       \n  #       new_table&lt;-val_df %&gt;% select(\"Sub_Indicator\"=subnm,\"Historical_Mean\"=mean, \"Historical_SD\"=sd, \"Last 5_Mean\"=mean_sym, \"Last 5_Slope\"=slope_sym, \"Selected_Mean\"=mean_sel, \"Selected_Slope\"=slope_sel) %&gt;% \n  #         group_by(Sub_Indicator) %&gt;% pivot_longer(cols = -c(\"Sub_Indicator\"))\n  #       \n  #       \n  #       new_table &lt;- new_table %&gt;% pivot_wider(names_from = name, values_from = value)\n  #       new_table[,2:3]&lt;-lapply(new_table[,2:3], function(x) {round(as.numeric(x),2)})\n  #       rownames(new_table)&lt;-new_table$Sub_Indicator\n  #       \n  #       gt(new_table, rowname_col = \"Sub_Indicator\", groupname_col = NA) %&gt;%\n  #         tab_spanner_delim(delim = \"_\") %&gt;%\n  #         tab_stubhead(label = \"Sub Indicator\") %&gt;% \n  #         tab_header(title = \"Trends in Mean & Slope\") %&gt;%\n  #         tab_options(table.border.top.color = \"#3498db\",\n  #                     table.border.bottom.color = \"#3498db\",\n  #                     table.border.left.color = \"#3498db\",\n  #                     table.border.right.color = \"#3498db\",\n  #                     table.border.top.width = 5,\n  #                     table.border.bottom.width = 5,\n  #                     table.border.left.width = 5,\n  #                     table.border.right.width = 5,\n  #                     table.border.left.style = \"solid\",\n  #                     table.border.right.style = \"solid\",) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_body()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stubhead()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stub()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_column_labels()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_column_spanners()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(24), color=\"#3498db\", weight = \"bold\"),locations = cells_title())\n  #     }\n  #     \n  #     \n  #   } else {\n  #     \n  #     ###Table stuff\n  #     if (ncol(df_dat)&lt;5.5) {\n  #       new_table&lt;-data.frame(val=c(round(val_df$mean,2), round(val_df$sd,2), val_df$mean_sym, val_df$slope_sym),\n  #                             metric=c(\"Historical_Mean\",\"Historical_SD\",\"Last 5_Mean\", \"Last 5_Slope\"))\n  #       \n  #       new_table &lt;- new_table %&gt;% pivot_wider(names_from = metric, values_from = val)\n  #       \n  #       gt(new_table) %&gt;%\n  #         tab_spanner_delim(delim = \"_\") %&gt;%\n  #         tab_stubhead(label = \"Sub Indicator\") %&gt;% \n  #         tab_header(title = \"Trends in Mean & Slope\") %&gt;%\n  #         tab_options(table.border.top.color = \"#3498db\",\n  #                     table.border.bottom.color = \"#3498db\",\n  #                     table.border.left.color = \"#3498db\",\n  #                     table.border.right.color = \"#3498db\",\n  #                     table.border.top.width = 5,\n  #                     table.border.bottom.width = 5,\n  #                     table.border.left.width = 5,\n  #                     table.border.right.width = 5,\n  #                     table.border.left.style = \"solid\",\n  #                     table.border.right.style = \"solid\",) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_body()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stubhead()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stub()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_column_labels()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_column_spanners()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(24), color=\"#3498db\", weight = \"bold\"),locations = cells_title())\n  #       \n  #     } else {\n  #       val_df$mean&lt;-as.character(val_df$mean)\n  #       val_df$sd&lt;-as.character(val_df$sd)\n  #       \n  #       new_table&lt;-val_df %&gt;% select(\"Sub_Indicator\"=subnm,\"Historical_Mean\"=mean, \"Historical_SD\"=sd, \"Last 5_Mean\"=mean_sym, \"Last 5_Slope\"=slope_sym) %&gt;% \n  #         group_by(Sub_Indicator) %&gt;% pivot_longer(cols = -c(\"Sub_Indicator\"))\n  #       \n  #       \n  #       new_table &lt;- new_table %&gt;% pivot_wider(names_from = name, values_from = value)\n  #       new_table[,2:3]&lt;-lapply(new_table[,2:3], function(x) {round(as.numeric(x),2)})\n  #       rownames(new_table)&lt;-new_table$Sub_Indicator\n  #       \n  #       gt(new_table, rowname_col = \"Sub_Indicator\", groupname_col = NA) %&gt;%\n  #         tab_spanner_delim(delim = \"_\") %&gt;%\n  #         tab_stubhead(label = \"Sub Indicator\") %&gt;% \n  #         tab_header(title = \"Trends in Mean & Slope\") %&gt;%\n  #         tab_options(table.border.top.color = \"#3498db\",\n  #                     table.border.bottom.color = \"#3498db\",\n  #                     table.border.left.color = \"#3498db\",\n  #                     table.border.right.color = \"#3498db\",\n  #                     table.border.top.width = 5,\n  #                     table.border.bottom.width = 5,\n  #                     table.border.left.width = 5,\n  #                     table.border.right.width = 5,\n  #                     table.border.left.style = \"solid\",\n  #                     table.border.right.style = \"solid\",) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_body()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stubhead()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18), weight = \"bold\", color=\"#2c3e50\"),locations = cells_stub()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(18)),locations = cells_column_labels()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(20), weight = \"bold\", color=\"#2c3e50\"),locations = cells_column_spanners()) %&gt;%\n  #         tab_style(style = cell_text(align = \"center\", size=px(24), color=\"#3498db\", weight = \"bold\"),locations = cells_title())\n  #       \n  #       \n  #       \n  #       \n  #       \n  #       \n  #       \n  #     }\n  #     \n  #   }\n  # })\n  # \n \n  #  #####Sel Trend Plot#####\n  # output$trend_plot&lt;- renderPlot({\n  #       df_pick &lt;- switch(input$data, \"Nuisance Aquatic Vegetation\"=nav,\"Oil Spills\"=oilsp, \"Red Drum\"=drum, \"Blue Crab Catch\"=blucrabcat,\"Brown Pelican\"=brownpeli, \"Oyster Catch\"=oystercat,\"Percent Small Business\"=persmallbusi,\"Vessels Fishing & Seafood Dealers\"=vesfish)\n  #   df_dat&lt;-df_dat_fn(df_pick)\n  #   val_df&lt;-val_df(df_dat)\n  #   selected_data &lt;- event_data(\"plotly_relayout\")\n  #   sel_dat&lt;-df_dat[df_dat$year&gt;selected_data$xaxis.range[1] & df_dat$year&lt; selected_data$xaxis.range[2],]\n  #   \n  #   \n  #   if(nrow(sel_dat)&gt;3) {\n  #     \n  #     #Mean Trend\n  #     sel_dat_mean&lt;-mean(sel_dat$value) # mean value last 5 years\n  #     mean_tr_sel&lt;-if_else(sel_dat_mean&gt;val_df$mean+val_df$sd, \"ptPlus\", if_else(sel_dat_mean&lt;val_df$mean-val_df$sd, \"ptMinus\",\"ptSolid\")) #qualify mean trend\n  #     \n  #     #Slope Trend\n  #     lmout&lt;-summary(lm(sel_dat$value~sel_dat$year))\n  #     sel_slope&lt;-coef(lmout)[2,1] * length(unique(sel_dat$year)) #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n  #     slope_tr_sel&lt;-if_else(sel_slope&gt;val_df$sd, \"arrowUp\", if_else(sel_slope&lt; c(-val_df$sd), \"arrowDown\",\"arrowRight\"))\n  #     \n  #     range&lt;-range(sel_dat$year)\n  #     \n  #     plot_trend&lt;-testtrend_base+\n  #       draw_image(get(mean_tr_sel), scale=0.35, y=0.25)+\n  #       draw_image(get(slope_tr_sel), scale=0.35, y=-0.3)+\n  #       labs(title = paste0(\"Selected Years\\n(\",range[1],\"-\",range[2],\")\"))\n  #     \n  #     plot_trend\n  #   }\n  #   \n  # }, bg=\"transparent\")\n  # \n  # #####Last5 Trend Plot#####\n  # output$trendplot_last5&lt;- renderPlot({\n  #       df_pick &lt;- switch(input$data, \"Nuisance Aquatic Vegetation\"=nav,\"Oil Spills\"=oilsp, \"Red Drum\"=drum, \"Blue Crab Catch\"=blucrabcat,\"Brown Pelican\"=brownpeli, \"Oyster Catch\"=oystercat,\"Percent Small Business\"=persmallbusi,\"Vessels Fishing & Seafood Dealers\"=vesfish)\n  #   df_dat&lt;-df_dat_fn(df_pick)\n  #   val_df&lt;-val_fn(df_dat)\n  #   \n  #   testtrend_base+\n  #     draw_image(get(val_df$mean_tr), scale=0.35, y=0.25)+\n  #     draw_image(get(val_df$slope_tr), scale=0.35, y=-0.3)+\n  #     labs(title = \"Last Five Years\\nof Data\")\n  #   \n  # }, bg=\"transparent\")\n  # \n  # #####Plain Text#####\n  # output$plain_header&lt;- renderText({\n  #   plain_header&lt;-paste0(\"&lt;b&gt;&lt;u&gt;Summary&lt;/b&gt;&lt;/u&gt;\")\n  # })\n  # \n  # output$plain_text&lt;-renderText({\n  #       df_pick &lt;- switch(input$data, \"Nuisance Aquatic Vegetation\"=nav,\"Oil Spills\"=oilsp, \"Red Drum\"=drum, \"Blue Crab Catch\"=blucrabcat,\"Brown Pelican\"=brownpeli, \"Oyster Catch\"=oystercat,\"Percent Small Business\"=persmallbusi,\"Vessels Fishing & Seafood Dealers\"=vesfish)\n  #   df_dat&lt;-df_dat_fn(df_pick)\n  #   df_lab&lt;-df_pick[1:3, c(1:ncol(df_pick))] #For example sake cutting to only col I need\n  #   val_df&lt;-val_fn(df_dat)\n  #   selected_data &lt;- event_data(\"plotly_relayout\")\n  #   sel_dat&lt;-df_dat[df_dat$year&gt;selected_data$xaxis.range[1] & df_dat$year&lt; selected_data$xaxis.range[2],]\n  #   \n  #   if (nrow(sel_dat)&lt;3) {\n  #     ###Not selected no subs\n  #     if (ncol(df_dat)&lt;5.5) {\n  #       text&lt;-paste0(\"The &lt;b&gt;\",df_lab[1,2] ,\"&lt;/b&gt; indicator has a historical mean of &lt;u&gt;&lt;b&gt;\", round(val_df$mean[1],2),\"&lt;/u&gt;&lt;/b&gt; ±&lt;u&gt;&lt;b&gt;\",round(val_df$sd[1],2)  ,\"&lt;/u&gt;&lt;/b&gt; and trends for the last five years of data show mean values &lt;b&gt;&lt;u&gt;\",val_df$mean_word, \"&lt;/b&gt;&lt;/u&gt; 1 standard deviation from the historical mean and &lt;u&gt;&lt;b&gt;\",val_df$slope_word, \"&lt;/u&gt;&lt;/b&gt; trend in slope.\")\n  #     } else {\n  #       ###Not slected subs\n  #       val_df$mean&lt;-as.character(val_df$mean)\n  #       val_df$sd&lt;-as.character(val_df$sd)\n  #       \n  #       new_table&lt;-val_df %&gt;% select(subnm, mean,  sd,  mean_sym,  slope_sym) %&gt;% \n  #         group_by(subnm) %&gt;% pivot_longer(cols = -c(subnm))\n  #       \n  #       val_df$mean&lt;-as.numeric(val_df$mean)\n  #       val_df$sd&lt;-as.numeric(val_df$sd)\n  #       \n  #       \n  #       text&lt;-paste0(\"The &lt;b&gt;\",df_lab[1,2] ,\"&lt;/b&gt; indicator for the &lt;u&gt;&lt;b&gt;\", val_df$subnm[1],\"&lt;/u&gt;&lt;/b&gt; sub indicator has a historical mean of &lt;u&gt;&lt;b&gt;\", round(val_df$mean[1],2),\"&lt;/u&gt;&lt;/b&gt; ±&lt;u&gt;&lt;b&gt;\",round(val_df$sd[1],2)  ,\"&lt;/u&gt;&lt;/b&gt; and trends for the last five years of data show mean values &lt;b&gt;&lt;u&gt;\",val_df$mean_word[1], \"&lt;/b&gt;&lt;/u&gt; 1 standard deviation from the historical mean and &lt;u&gt;&lt;b&gt;\",val_df$slope_word[1], \"&lt;/u&gt;&lt;/b&gt; trend in slope.\")\n  #       \n  #       text_li&lt;-list()\n  #       for (i in 2:length(val_df$subnm)) {\n  #         subtext&lt;-paste0(\"The &lt;u&gt;&lt;b&gt;\",val_df$subnm[i], \"&lt;/u&gt;&lt;/b&gt; sub index historical mean is &lt;u&gt;&lt;b&gt;\",round(val_df$mean[i],2),\"&lt;/u&gt;&lt;/b&gt;±&lt;u&gt;&lt;b&gt;\",round(val_df$sd[i],2),\"&lt;/u&gt;&lt;/b&gt; and trends from the last five years of data show mean values&lt;u&gt;&lt;b&gt;\",val_df$mean_word[i],\"&lt;/u&gt;&lt;/b&gt; 1 standard deviation from the historical mean and &lt;u&gt;&lt;b&gt;\",val_df$slope_word[i], \"&lt;/u&gt;&lt;/b&gt; trend in slope.\") \n  #         text_li[[i]]&lt;-subtext\n  #       }\n  #       subs_text&lt;-do.call(\"paste\", text_li)\n  #       paste(text,subs_text)\n  #     }\n  #     \n  #     \n  #   } else {\n  #     if (ncol(df_dat)&lt;5.5) {\n  #       \n  #       #Selected no subs\n  #       #Mean Trend\n  #       sel_dat_mean&lt;-mean(sel_dat$value) # mean value last 5 years\n  #       mean_sel_word&lt;-if_else(sel_dat_mean&gt;val_df$mean+val_df$sd, \"greater\", if_else(sel_dat_mean&lt;val_df$mean-val_df$sd, \"below\",\"within\")) #qualify mean trend\n  #       \n  #       #Slope Trend\n  #       lmout&lt;-summary(lm(sel_dat$value~sel_dat$year))\n  #       sel_slope&lt;-coef(lmout)[2,1] * length(unique(sel_dat$year)) #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n  #       slope_sel_word&lt;-if_else(sel_slope&gt;val_df$sd, \"an increasing\", if_else(sel_slope&lt; c(-val_df$sd), \"a decreasing\",\"a stable\"))\n  #       \n  #       range&lt;-range(sel_dat$year)\n  #       \n  #       text&lt;-paste0(\"The &lt;b&gt;\",df_lab[1,2] ,\"&lt;/b&gt; indicator has a historical mean of &lt;u&gt;&lt;b&gt;\", round(val_df$mean[1],2),\"&lt;/u&gt;&lt;/b&gt; ±&lt;u&gt;&lt;b&gt;\",round(val_df$sd[1],2)  ,\"&lt;/u&gt;&lt;/b&gt; and trends for the last five years of data show mean values &lt;b&gt;&lt;u&gt;\",val_df$mean_word, \"&lt;/u&gt;&lt;/b&gt; 1 standard deviation from the historical mean and &lt;b&gt;&lt;u&gt;\",val_df$slope_word, \"&lt;/b&gt;&lt;/u&gt; trend in slope. The trends in the selected years of data &lt;b&gt;(\",range[1],\"-\",range[2],\")&lt;/b&gt; show mean values &lt;b&gt;&lt;u&gt;\", mean_sel_word,\"&lt;/b&gt;&lt;/u&gt; 1 standard deviation from the historical mean and &lt;b&gt;&lt;u&gt;\",slope_sel_word, \"&lt;/b&gt;&lt;/u&gt; trend in slope.\")\n  #       \n  #       \n  #     } else {\n  #       ###Selected w subs\n  #       sub_list&lt;-list()\n  #       subs&lt;-unique(df_dat$subnm)\n  #       for (i in 1:length(subs)){\n  #         sub_df&lt;-sel_dat[sel_dat$subnm==subs[i],]\n  #         vals&lt;-val_df[val_df$subnm==subs[i],]\n  #         sub_dat_mean&lt;-mean(sub_df$value) # mean value last 5 years\n  #         mean_sub&lt;-if_else(sub_dat_mean&gt;vals$mean+vals$sd, \"greater\", if_else(sub_dat_mean&lt;vals$mean-vals$sd, \"below\",\"within\")) #qualify mean trend\n  #         \n  #         #Slope Trend\n  #         lmout&lt;-summary(lm(sub_df$value~sub_df$year))\n  #         sub_slope&lt;-coef(lmout)[2,1] * length(unique(sub_df$year)) #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n  #         slope_sub&lt;-if_else(sub_slope&gt;vals$sd, \"an increasing\", if_else(sub_slope&lt; c(-vals$sd), \"a decreasing\",\"a stable\"))\n  #         \n  #         add_sub&lt;-data.frame(mean_sel=mean_sub,\n  #                             slope_sel=slope_sub)\n  #         sub_list[[i]]&lt;-add_sub\n  #         \n  #       }\n  #       add_sel_df&lt;-do.call(\"rbind\",sub_list)\n  #       val_df&lt;-cbind(val_df, add_sel_df)\n  #       \n  #       val_df$mean&lt;-as.character(val_df$mean)\n  #       val_df$sd&lt;-as.character(val_df$sd)\n  #       \n  #       val_df&lt;-val_df %&gt;% select(subnm,mean, sd, mean_word, slope_word, mean_sel, slope_sel)\n  #       val_df$mean&lt;-as.numeric(val_df$mean)\n  #       val_df$sd&lt;-as.numeric(val_df$sd)\n  #       \n  #       range&lt;-range(sel_dat$year)\n  #       \n  #       text&lt;-paste0(\"The &lt;b&gt;\",df_lab[1,2] ,\"&lt;/b&gt; indicator for the &lt;u&gt;&lt;b&gt;\", val_df$subnm[1],\"&lt;/u&gt;&lt;/b&gt; sub indicator has a historical mean of &lt;u&gt;&lt;b&gt;\", round(val_df$mean[1],2),\"&lt;/u&gt;&lt;/b&gt; ±&lt;u&gt;&lt;b&gt;\",round(val_df$sd[1],2)  ,\"&lt;/u&gt;&lt;/b&gt; and trends for the last five years of data show mean values &lt;b&gt;&lt;u&gt;\",val_df$mean_word[1], \"&lt;/b&gt;&lt;/u&gt; 1 standard deviation from the historical mean and &lt;u&gt;&lt;b&gt;\",val_df$slope_word[1], \"&lt;/u&gt;&lt;/b&gt; trend in slope. The trends in the selected years of data &lt;b&gt;(\",range[1],\"-\",range[2],\")&lt;/b&gt; show mean values &lt;b&gt;&lt;u&gt;\", val_df$mean_sel[1],\"&lt;/b&gt;&lt;/u&gt; 1 standard deviation from the historical mean and &lt;b&gt;&lt;u&gt;\",val_df$slope_sel[1], \"&lt;/b&gt;&lt;/u&gt; trend in slope.\")\n  #       \n  #       text_li&lt;-list()\n  #       for (i in 2:length(val_df$subnm)) {\n  #         subtext&lt;-paste0(\"The &lt;u&gt;&lt;b&gt;\",val_df$subnm[i], \"&lt;/u&gt;&lt;/b&gt; sub index historical mean is &lt;u&gt;&lt;b&gt;\",round(val_df$mean[i],2),\" &lt;/u&gt;&lt;/b&gt;±&lt;u&gt;&lt;b&gt;\",round(val_df$sd[i],2),\"&lt;/u&gt;&lt;/b&gt; and trends from the last five years of data show mean values &lt;u&gt;&lt;b&gt;\",val_df$mean_word[i],\"&lt;/u&gt;&lt;/b&gt; 1 standard deviation from the historical mean and &lt;u&gt;&lt;b&gt;\",val_df$slope_word[i], \"&lt;/u&gt;&lt;/b&gt; trend in slope. The trends in the selected years of data show mean values &lt;b&gt;&lt;u&gt;\", val_df$mean_sel[i],\"&lt;/b&gt;&lt;/u&gt; 1 standard deviation from the historical mean and &lt;b&gt;&lt;u&gt;\",val_df$slope_sel[i], \"&lt;/b&gt;&lt;/u&gt; trend in slope.\") \n  #         text_li[[i]]&lt;-subtext\n  #       }\n  #       subs_text&lt;-do.call(\"paste\", text_li)\n  #       paste(text,subs_text)\n  #       \n  #     }\n  #     \n  #     \n  #   }\n  # })\n  # \n\n  # #####STUFF FOR INFO PAGE#####\n  # #Help fig\n  # output$plotimg&lt;-renderImage({\n  #   list(src=\"WWW/TS_info.png\",\n  #        contentType=\"image/png\",\n  #        align=\"center\")\n  # }, deleteFile = F)\n  # \n  # #Text\n  # output$introtext&lt;-renderText({\n  #   \n  #   introtext&lt;-\"This app is intended to provide a way to interact with indicators from the Barataria Basin Ecosystem Status Report (ESR). The Barataria Basin ESR is a report with over 100 indicators describing drivers, pressures, states, human activities, and human dimensions produced by NOAA's Integrated Ecosystem Assessment (IEA) program. This is a prototype app with a small selection of indicators in order to get feedback for a potential future product.\"\n  # })\n  # \n  # output$usehead&lt;-renderText({\n  #   \n  #   infotext&lt;-\"How to Use\"\n  # })\n  # \n  # output$infotext1&lt;-renderText({\n  #   \n  #   infotext1&lt;-\"&lt;b&gt;1.&lt;/b&gt; Begin by choosing the indicator from the dropdown menu on the left of the screen. &lt;br&gt;&lt;br&gt;\n  #     &lt;b&gt;2&lt;/b&gt;. The indicator time series plot will be updated on the right. Below is a figure on how to interpret the plot.\"\n  # })\n  # \n  # output$infotext2&lt;-renderText({\n  #   \n  #   infotext2&lt;-\"&lt;b&gt;3.&lt;/b&gt; Below the plot is a rangeslider. Pull on either end of the slider to customize the time range of the plot. The time frame you have chosen will appear in text below the slider, originally indicating the full time frame of the indicator. &lt;br&gt;&lt;br&gt;\n  #     &lt;b&gt;4.&lt;/b&gt; A table below the figure show the historical mean and standard deviation (presented as dashed and solid black horizontal lines) and the trends in mean and slope compared to those values of the last five years of data as presented in the ESR. This table will update with trends of mean and slope if a custom time frame is selected using the rangeslider. &lt;br&gt;&lt;br&gt;\n  #     &lt;b&gt;5.&lt;/b&gt; Below the table is a plain text summary of the table above, describing mean and SD values as well as trends in mean and slope for the last five years of data and slected time frames.\" \n  # })\n  # \n}\n\n\n\n# Run the application \napp&lt;-shinyApp(ui = ui, server = server)"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "BB ESR Viz Intro",
    "section": "",
    "text": "Here is the title page to the repo website.\nThings I should put here\n\nGeneral info about the BB ESR\nPictures of front of it\nLink to the ESR\nExecutive Summary?\nTest to see if things change…again"
  },
  {
    "objectID": "Data_Obj/App_Prep.html",
    "href": "Data_Obj/App_Prep.html",
    "title": "App_Prep",
    "section": "",
    "text": "Library\nlibrary(ggplot2)\n\nWarning: package 'ggplot2' was built under R version 4.3.3\n\nlibrary(plotly)\n\nWarning: package 'plotly' was built under R version 4.3.3\n\n\n\nAttaching package: 'plotly'\n\n\nThe following object is masked from 'package:ggplot2':\n\n    last_plot\n\n\nThe following object is masked from 'package:stats':\n\n    filter\n\n\nThe following object is masked from 'package:graphics':\n\n    layout\n\nlibrary(tidyr)\n\nWarning: package 'tidyr' was built under R version 4.3.3\n\nlibrary(dplyr)\n\nWarning: package 'dplyr' was built under R version 4.3.2\n\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\nLoad Data\ncrab&lt;-read.csv(\"Data_CSV/bluecrab_cat.csv\", header=F)\npeli&lt;-read.csv(\"Data_CSV/brown_peli.csv\", header=F)\nnav&lt;-read.csv(\"Data_CSV/NAV.csv\", header=F)\noilspill&lt;-read.csv(\"Data_CSV/OilSpills.csv\", header=F)\noyster&lt;-read.csv(\"Data_CSV/oyster_cat.csv\", header=F)\nsml_bus&lt;-read.csv(\"Data_CSV/per_small_busi.csv\", header=F)\nred_drum&lt;-read.csv(\"Data_CSV/Red_Drum.csv\", header=F)\nsst&lt;-read.csv(\"Data_CSV/sst_raw.csv\", header=F)\nves_deal&lt;-read.csv(\"Data_CSV/VesselsFishing_SeafoodDealers.csv\", header=F)\nFunctions for making data\n#Data used for everything\ndf_dat_fn&lt;-function(df) {\n  df_dat&lt;-df[4:nrow(df),c(1:ncol(df))] \n  \n  if (ncol(df_dat)&lt;2.5) {\n    colnames(df_dat)&lt;-c(\"year\",\"value\")\n    df_dat$value&lt;- as.numeric(df_dat$value)\n    \n    mean&lt;-mean(as.numeric(df_dat$value), na.rm = T)\n    sd&lt;-sd(as.numeric(df_dat$value), na.rm = T)\n    \n    df_dat$valence[df_dat$value&gt;=mean]&lt;-\"pos\"\n    df_dat$valence[df_dat$value&lt; mean]&lt;-\"neg\"\n    df_dat$min &lt;- ifelse(df_dat$value &gt;= mean, mean, df_dat$value)\n    df_dat$max &lt;- ifelse(df_dat$value &gt;= mean, df_dat$value, mean)\n    df_dat$year &lt;- as.numeric(df_dat$year)\n    df_dat} else {\n      \n      sub_list&lt;-list() \n      for (i in 2:ncol(df_dat)){\n        sub_df&lt;-df_dat[,c(1,i)]\n        df_lab&lt;-df[1:3,] #For example sake cutting to only col I need\n        ind&lt;-df_lab[3,]\n        colnames(sub_df)&lt;-c(\"year\",\"value\")\n        # sub_df$value&lt;- as.numeric(sub_df$value)\n        sub_df&lt;-as.data.frame(lapply(sub_df, as.numeric))\n        \n        mean&lt;-mean(as.numeric(sub_df$value), na.rm = T)\n        sd&lt;-sd(as.numeric(sub_df$value), na.rm = T)\n        \n        sub_df$valence[sub_df$value&gt;=mean]&lt;-\"pos\"\n        sub_df$valence[sub_df$value&lt; mean]&lt;-\"neg\"\n        sub_df$min &lt;- ifelse(sub_df$value &gt;= mean, mean, sub_df$value)\n        sub_df$max &lt;- ifelse(sub_df$value &gt;= mean, sub_df$value, mean)\n        sub_df$year &lt;- as.numeric(sub_df$year)\n        sub_df$subnm&lt;-ind[,i]\n        sub_list[[i]]&lt;-sub_df\n        \n      }\n      df_dat&lt;-do.call(\"rbind\",sub_list)\n    }\n  df_dat\n  \n}\n\n#Pos data set used for main plot\npos_fn&lt;-function(df_dat) {\n  if(ncol(df_dat)&lt;6){\n    mean&lt;-mean(as.numeric(df_dat$value), na.rm = T)\n    sd&lt;-sd(as.numeric(df_dat$value), na.rm = T)\n    pos&lt;-df_dat\n    pos$value&lt;-ifelse(pos$valence == \"pos\",pos$value, mean)\n    pos} else {\n      sub_list&lt;-list()\n      subs&lt;-unique(df_dat$subnm)\n      for (i in 1:length(subs)){\n        sub_df&lt;-df_dat[df_dat$subnm==subs[i],]\n        mean&lt;-mean(as.numeric(sub_df$value), na.rm = T)\n        sd&lt;-sd(as.numeric(sub_df$value), na.rm = T)\n        pos&lt;-sub_df\n        pos$value&lt;-ifelse(pos$valence == \"pos\",pos$value, mean)\n        pos$subnm&lt;-subs[i]\n        pos$mean&lt;-mean\n        pos$sd&lt;-sd\n        sub_list[[i]]&lt;-pos\n      }\n      pos&lt;-do.call(\"rbind\",sub_list)\n      pos\n    }\n}\n\n#Neg data set used for main plot\nneg_fn&lt;-function(df_dat) {\n  if(ncol(df_dat)&lt;6){\n    mean&lt;-mean(as.numeric(df_dat$value), na.rm = T)\n    sd&lt;-sd(as.numeric(df_dat$value), na.rm = T)\n    neg&lt;-df_dat\n    neg$value&lt;-ifelse(neg$valence == \"neg\",neg$value, mean)\n    neg} else {\n      sub_list&lt;-list()\n      subs&lt;-unique(df_dat$subnm)\n      for (i in 1:length(subs)){\n        sub_df&lt;-df_dat[df_dat$subnm==subs[i],]\n        mean&lt;-mean(as.numeric(sub_df$value), na.rm = T)\n        sd&lt;-sd(as.numeric(sub_df$value), na.rm = T)\n        neg&lt;-sub_df\n        neg$value&lt;-ifelse(neg$valence == \"neg\",neg$value, mean)\n        neg$subnm&lt;-subs[i]\n        neg$mean&lt;-mean\n        neg$sd&lt;-sd\n        sub_list[[i]]&lt;-neg\n      }\n      neg&lt;-do.call(\"rbind\",sub_list)\n      neg\n    }\n}\n\n#Independent values used throughout\nval_fn&lt;-function(df_dat) {\n  if(ncol(df_dat)&lt;6){\n    mean&lt;-mean(as.numeric(df_dat$value), na.rm = T)\n    sd&lt;-sd(as.numeric(df_dat$value), na.rm = T)\n    \n    #Trend Analysis\n    last5&lt;-df_dat[df_dat$year &gt; max(df_dat$year)-5,]\n    #Mean Trend\n    last5_mean&lt;-mean(last5$value) # mean value last 5 years\n    mean_tr&lt;-if_else(last5_mean&gt;mean+sd, \"ptPlus\", if_else(last5_mean&lt;mean-sd, \"ptMinus\",\"ptSolid\")) #qualify mean trend\n    mean_sym&lt;-if_else(last5_mean&gt;mean+sd, \"+\", if_else(last5_mean&lt;mean-sd, \"-\",\"●\")) #qualify mean trend\n    mean_word&lt;-if_else(last5_mean&gt;mean+sd, \"greater\", if_else(last5_mean&lt;mean-sd, \"below\",\"within\")) #qualify mean trend\n    \n    #Slope Trend\n    lmout&lt;-summary(lm(last5$value~last5$year))\n    last5_slope&lt;-coef(lmout)[2,1] * 5 #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n    slope_tr&lt;-if_else(last5_slope&gt;sd, \"arrowUp\", if_else(last5_slope&lt; c(-sd), \"arrowDown\",\"arrowRight\"))\n    slope_sym&lt;-if_else(last5_slope&gt;sd, \"↑\", if_else(last5_slope&lt; c(-sd), \"↓\",\"→\"))\n    slope_word&lt;-if_else(last5_slope&gt;sd, \"an increasing\", if_else(last5_slope&lt; c(-sd), \"a decreasing\",\"a stable\"))\n    \n    #Dataframe\n    vals&lt;-data.frame(mean=mean,\n                     sd=sd,\n                     mean_tr=mean_tr,\n                     slope_tr=slope_tr,\n                     mean_sym=mean_sym,\n                     slope_sym=slope_sym,\n                     mean_word=mean_word,\n                     slope_word=slope_word)\n    vals} else {\n      sub_list&lt;-list()\n      subs&lt;-unique(df_dat$subnm)\n      for (i in 1:length(subs)){\n        sub_df&lt;-df_dat[df_dat$subnm==subs[i],]\n        minyear&lt;-min(na.omit(sub_df)$year)\n        maxyear&lt;-max(na.omit(sub_df)$year)\n        allminyear&lt;-min(df_dat$year)\n        allmaxyear&lt;-max(df_dat$year)\n        mean&lt;-mean(as.numeric(sub_df$value), na.rm = T)\n        sd&lt;-sd(as.numeric(sub_df$value), na.rm = T)\n        \n        #Trend Analysis\n        last5&lt;-sub_df[sub_df$year &gt; max(sub_df$year)-5,]\n        #Mean Trend\n        last5_mean&lt;-mean(last5$value) # mean value last 5 years\n        mean_tr&lt;-if_else(last5_mean&gt;mean+sd, \"ptPlus\", if_else(last5_mean&lt;mean-sd, \"ptMinus\",\"ptSolid\")) #qualify mean trend\n        mean_sym&lt;-if_else(last5_mean&gt;mean+sd, \"+\", if_else(last5_mean&lt;mean-sd, \"-\",\"●\")) #qualify mean trend\n        mean_word&lt;-if_else(last5_mean&gt;mean+sd, \"greater\", if_else(last5_mean&lt;mean-sd, \"below\",\"within\")) #qualify mean trend\n        \n        #Slope Trend\n        lmout&lt;-summary(lm(last5$value~last5$year))\n        last5_slope&lt;-coef(lmout)[2,1] * 5 #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n        slope_tr&lt;-if_else(last5_slope&gt;sd, \"arrowUp\", if_else(last5_slope&lt; c(-sd), \"arrowDown\",\"arrowRight\"))\n        slope_sym&lt;-if_else(last5_slope&gt;sd, \"↑\", if_else(last5_slope&lt; c(-sd), \"↓\",\"→\"))\n        slope_word&lt;-if_else(last5_slope&gt;sd, \"an increasing\", if_else(last5_slope&lt; c(-sd), \"a decreasing\",\"a stable\"))\n        \n        vals&lt;-data.frame(allminyear=allminyear,\n                         allmaxyear=allmaxyear,\n                         minyear=minyear,\n                         maxyear=maxyear,\n                         mean=mean,\n                         sd=sd,\n                         mean_tr=mean_tr,\n                         slope_tr=slope_tr,\n                         mean_sym=mean_sym,\n                         slope_sym=slope_sym,\n                         mean_word=mean_word,\n                         slope_word=slope_word,\n                         subnm=subs[i])\n        \n        \n        sub_list[[i]]&lt;-vals\n      }\n      vals&lt;-do.call(\"rbind\",sub_list)\n      vals\n    }\n}\n\n#Main Plot\nplot_fn&lt;-function(df_dat, pos, neg, df_lab, val_df) {\n  \n  \n  if (ncol(df_dat)&lt;5.5){\n    #single plot\n    plot_main&lt;-ggplot(data=df_dat, aes(x=year, y=value))+\n      geom_ribbon(data=pos, aes(group=1,ymax=max, ymin=val_df$mean),fill=\"#7FFF7F\")+\n      geom_ribbon(data=neg, aes(group=1,ymax=val_df$mean, ymin=min), fill=\"#FF7F7F\")+\n      geom_rect(aes(xmin=min(df_dat$year),xmax=max(df_dat$year),ymin=val_df$mean-val_df$sd, ymax=val_df$mean+val_df$sd), fill=\"white\")+\n      geom_hline(yintercept=val_df$mean, lty=\"dashed\")+\n      geom_hline(yintercept=val_df$mean+val_df$sd)+\n      geom_hline(yintercept=val_df$mean-val_df$sd)+\n      geom_line(aes(group=1), lwd=1)+\n      labs(x=\"Year\", y=df_lab[2,2], title = df_lab[1,2])+\n      theme_bw() + theme(title = element_text(size=14, face = \"bold\"))\n    \n    if (max(df_dat$year)-min(df_dat$year)&gt;20) {\n      plot_main&lt;-plot_main+scale_x_continuous(breaks = seq(min(df_dat$year),max(df_dat$year),5))\n    } else {\n      plot_main&lt;-plot_main+scale_x_continuous(breaks = seq(min(df_dat$year),max(df_dat$year),2))\n    }\n    plot_main\n    \n  } else {\n    #facet plot\n    \n    plot_sec&lt;-ggplot(data=df_dat, aes(x=year, y=value))+\n      facet_wrap(~subnm, ncol=1, scales = \"free_y\")+\n      geom_ribbon(data=pos, aes(group=subnm,ymax=max, ymin=mean),fill=\"#7FFF7F\")+\n      geom_ribbon(data=neg, aes(group=subnm,ymax=mean, ymin=min), fill=\"#FF7F7F\")+\n      geom_rect(data=merge(df_dat,val_df), aes(xmin=allminyear,xmax=allmaxyear,ymin=mean-sd, ymax=mean+sd), fill=\"white\")+\n      geom_hline(aes(yintercept=mean), lty=\"dashed\",data=val_df)+\n      geom_hline(aes(yintercept=mean+sd),data=val_df)+\n      geom_hline(aes(yintercept=mean-sd),data=val_df)+\n      geom_line(aes(group=1), lwd=0.75)+\n      labs(x=\"Year\", y=df_lab[2,2], title = df_lab[1,2])+\n      theme_bw()+theme(strip.background = element_blank(),\n                       strip.text = element_text(face=\"bold\"),\n                       title = element_text(size=14, face = \"bold\"))\n    \n    if (max(df_dat$year)-min(df_dat$year)&gt;20) {\n      plot_sec&lt;-plot_sec+scale_x_continuous(breaks = seq(min(df_dat$year),max(df_dat$year),5))\n    } else {\n      # plot_sec&lt;-plot_sec+scale_x_continuous(breaks = seq(min(df_dat$year),max(df_dat$year),2))\n    }\n    plot_sec\n    \n  }\n}\nAll functions into one\ndata_prep_fn &lt;-function (df, list_nm) {\n  df_list&lt;-vector(\"list\", 5)\n  names(df_list)&lt;-c(\"data\", \"pos\", \"neg\", \"labs\", \"vals\")\n\n  #Data used for everything\n  df_dat&lt;-df[4:nrow(df),c(1:ncol(df))] \n  \n  if (ncol(df_dat)&lt;2.5) {\n    colnames(df_dat)&lt;-c(\"year\",\"value\")\n    df_dat$value&lt;- as.numeric(df_dat$value)\n    \n    mean&lt;-mean(as.numeric(df_dat$value), na.rm = T)\n    sd&lt;-sd(as.numeric(df_dat$value), na.rm = T)\n    \n    df_dat$valence[df_dat$value&gt;=mean]&lt;-\"pos\"\n    df_dat$valence[df_dat$value&lt; mean]&lt;-\"neg\"\n    df_dat$min &lt;- ifelse(df_dat$value &gt;= mean, mean, df_dat$value)\n    df_dat$max &lt;- ifelse(df_dat$value &gt;= mean, df_dat$value, mean)\n    df_dat$year &lt;- as.numeric(df_dat$year)\n    df_dat} else {\n      \n      sub_list&lt;-list() \n      for (i in 2:ncol(df_dat)){\n        sub_df&lt;-df_dat[,c(1,i)]\n        df_lab&lt;-df[1:3,] #For example sake cutting to only col I need\n        ind&lt;-df_lab[3,]\n        colnames(sub_df)&lt;-c(\"year\",\"value\")\n        # sub_df$value&lt;- as.numeric(sub_df$value)\n        sub_df&lt;-as.data.frame(lapply(sub_df, as.numeric))\n        \n        mean&lt;-mean(as.numeric(sub_df$value), na.rm = T)\n        sd&lt;-sd(as.numeric(sub_df$value), na.rm = T)\n        \n        sub_df$valence[sub_df$value&gt;=mean]&lt;-\"pos\"\n        sub_df$valence[sub_df$value&lt; mean]&lt;-\"neg\"\n        sub_df$min &lt;- ifelse(sub_df$value &gt;= mean, mean, sub_df$value)\n        sub_df$max &lt;- ifelse(sub_df$value &gt;= mean, sub_df$value, mean)\n        sub_df$year &lt;- as.numeric(sub_df$year)\n        sub_df$subnm&lt;-ind[,i]\n        sub_list[[i]]&lt;-sub_df\n        \n      }\n      df_dat&lt;-do.call(\"rbind\",sub_list)\n    }\n  df_list$data&lt;-df_dat\n  \n\n#Pos data set used for main plot\n\n  if(ncol(df_dat)&lt;6){\n    mean&lt;-mean(as.numeric(df_dat$value), na.rm = T)\n    sd&lt;-sd(as.numeric(df_dat$value), na.rm = T)\n    pos&lt;-df_dat\n    pos$value&lt;-ifelse(pos$valence == \"pos\",pos$value, mean)\n    pos} else {\n      sub_list&lt;-list()\n      subs&lt;-unique(df_dat$subnm)\n      for (i in 1:length(subs)){\n        sub_df&lt;-df_dat[df_dat$subnm==subs[i],]\n        mean&lt;-mean(as.numeric(sub_df$value), na.rm = T)\n        sd&lt;-sd(as.numeric(sub_df$value), na.rm = T)\n        pos&lt;-sub_df\n        pos$value&lt;-ifelse(pos$valence == \"pos\",pos$value, mean)\n        pos$subnm&lt;-subs[i]\n        pos$mean&lt;-mean\n        pos$sd&lt;-sd\n        sub_list[[i]]&lt;-pos\n      }\n      pos&lt;-do.call(\"rbind\",sub_list)\n    }\n      df_list$pos&lt;-pos\n\n\n#Neg data set used for main plot\n  if(ncol(df_dat)&lt;6){\n    mean&lt;-mean(as.numeric(df_dat$value), na.rm = T)\n    sd&lt;-sd(as.numeric(df_dat$value), na.rm = T)\n    neg&lt;-df_dat\n    neg$value&lt;-ifelse(neg$valence == \"neg\",neg$value, mean)\n    neg} else {\n      sub_list&lt;-list()\n      subs&lt;-unique(df_dat$subnm)\n      for (i in 1:length(subs)){\n        sub_df&lt;-df_dat[df_dat$subnm==subs[i],]\n        mean&lt;-mean(as.numeric(sub_df$value), na.rm = T)\n        sd&lt;-sd(as.numeric(sub_df$value), na.rm = T)\n        neg&lt;-sub_df\n        neg$value&lt;-ifelse(neg$valence == \"neg\",neg$value, mean)\n        neg$subnm&lt;-subs[i]\n        neg$mean&lt;-mean\n        neg$sd&lt;-sd\n        sub_list[[i]]&lt;-neg\n      }\n      neg&lt;-do.call(\"rbind\",sub_list)\n    }\n      df_list$neg&lt;-neg\n      \ndf_list$labs&lt;-df[1:3, c(1:ncol(df))]\n\n#Independent values used throughout\n  if(ncol(df_dat)&lt;6){\n    mean&lt;-mean(as.numeric(df_dat$value), na.rm = T)\n    sd&lt;-sd(as.numeric(df_dat$value), na.rm = T)\n    \n    #Trend Analysis\n    last5&lt;-df_dat[df_dat$year &gt; max(df_dat$year)-5,]\n    #Mean Trend\n    last5_mean&lt;-mean(last5$value) # mean value last 5 years\n    mean_tr&lt;-if_else(last5_mean&gt;mean+sd, \"ptPlus\", if_else(last5_mean&lt;mean-sd, \"ptMinus\",\"ptSolid\")) #qualify mean trend\n    mean_sym&lt;-if_else(last5_mean&gt;mean+sd, \"+\", if_else(last5_mean&lt;mean-sd, \"-\",\"●\")) #qualify mean trend\n    mean_word&lt;-if_else(last5_mean&gt;mean+sd, \"greater\", if_else(last5_mean&lt;mean-sd, \"below\",\"within\")) #qualify mean trend\n    \n    #Slope Trend\n    lmout&lt;-summary(lm(last5$value~last5$year))\n    last5_slope&lt;-coef(lmout)[2,1] * 5 #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n    slope_tr&lt;-if_else(last5_slope&gt;sd, \"arrowUp\", if_else(last5_slope&lt; c(-sd), \"arrowDown\",\"arrowRight\"))\n    slope_sym&lt;-if_else(last5_slope&gt;sd, \"↑\", if_else(last5_slope&lt; c(-sd), \"↓\",\"→\"))\n    slope_word&lt;-if_else(last5_slope&gt;sd, \"an increasing\", if_else(last5_slope&lt; c(-sd), \"a decreasing\",\"a stable\"))\n    \n    #Dataframe\n    vals&lt;-data.frame(mean=mean,\n                     sd=sd,\n                     mean_tr=mean_tr,\n                     slope_tr=slope_tr,\n                     mean_sym=mean_sym,\n                     slope_sym=slope_sym,\n                     mean_word=mean_word,\n                     slope_word=slope_word)\n    vals} else {\n      sub_list&lt;-list()\n      subs&lt;-unique(df_dat$subnm)\n      for (i in 1:length(subs)){\n        sub_df&lt;-df_dat[df_dat$subnm==subs[i],]\n        minyear&lt;-min(na.omit(sub_df)$year)\n        maxyear&lt;-max(na.omit(sub_df)$year)\n        allminyear&lt;-min(df_dat$year)\n        allmaxyear&lt;-max(df_dat$year)\n        mean&lt;-mean(as.numeric(sub_df$value), na.rm = T)\n        sd&lt;-sd(as.numeric(sub_df$value), na.rm = T)\n        \n        #Trend Analysis\n        last5&lt;-sub_df[sub_df$year &gt; max(sub_df$year)-5,]\n        #Mean Trend\n        last5_mean&lt;-mean(last5$value) # mean value last 5 years\n        mean_tr&lt;-if_else(last5_mean&gt;mean+sd, \"ptPlus\", if_else(last5_mean&lt;mean-sd, \"ptMinus\",\"ptSolid\")) #qualify mean trend\n        mean_sym&lt;-if_else(last5_mean&gt;mean+sd, \"+\", if_else(last5_mean&lt;mean-sd, \"-\",\"●\")) #qualify mean trend\n        mean_word&lt;-if_else(last5_mean&gt;mean+sd, \"greater\", if_else(last5_mean&lt;mean-sd, \"below\",\"within\")) #qualify mean trend\n        \n        #Slope Trend\n        lmout&lt;-summary(lm(last5$value~last5$year))\n        last5_slope&lt;-coef(lmout)[2,1] * 5 #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n        slope_tr&lt;-if_else(last5_slope&gt;sd, \"arrowUp\", if_else(last5_slope&lt; c(-sd), \"arrowDown\",\"arrowRight\"))\n        slope_sym&lt;-if_else(last5_slope&gt;sd, \"↑\", if_else(last5_slope&lt; c(-sd), \"↓\",\"→\"))\n        slope_word&lt;-if_else(last5_slope&gt;sd, \"an increasing\", if_else(last5_slope&lt; c(-sd), \"a decreasing\",\"a stable\"))\n        \n        vals&lt;-data.frame(allminyear=allminyear,\n                         allmaxyear=allmaxyear,\n                         minyear=minyear,\n                         maxyear=maxyear,\n                         mean=mean,\n                         sd=sd,\n                         mean_tr=mean_tr,\n                         slope_tr=slope_tr,\n                         mean_sym=mean_sym,\n                         slope_sym=slope_sym,\n                         mean_word=mean_word,\n                         slope_word=slope_word,\n                         subnm=subs[i])\n        \n        \n        sub_list[[i]]&lt;-vals\n      }\n      vals&lt;-do.call(\"rbind\",sub_list)\n\n    }\n  df_list$vals&lt;-vals\n  df_list\n}\nTest Functions on Data\npeli_df&lt;-df_dat_fn(peli)\npeli_pos&lt;-pos_fn(peli_df)\npeli_neg&lt;-neg_fn(peli_df)\npeli_lab&lt;-peli[1:3, c(1:ncol(peli))] #For example sake cutting to only col I need\npeli_val&lt;-val_fn(peli_df)\n\n\ntest&lt;-plot_fn(peli_df, peli_pos, peli_neg, peli_lab, peli_val)\nggplotly(test)\n\nWarning: Use of `df_dat$year` is discouraged.\nℹ Use `year` instead.\nUse of `df_dat$year` is discouraged.\nℹ Use `year` instead.\n\n\n\n\n\n#Put different parts of the plot data into a list\npeli_list&lt;-list(peli_df, peli_pos, peli_neg, peli_lab, peli_val)\nnames(peli_list)&lt;-c(\"data\", \"pos\", \"neg\", \"labs\", \"vals\")\n\nclass(peli_list)\n\n[1] \"list\"\n\nsaveRDS(peli_list, \"Peli_Obj.rds\")\nLoad Plot Fn\nplot_fn&lt;-function(df_dat, pos, neg, df_lab, val_df) {\n  \n  \n  if (ncol(df_dat)&lt;5.5){\n    #single plot\n    plot_main&lt;-ggplot(data=df_dat, aes(x=year, y=value))+\n      geom_ribbon(data=pos, aes(group=1,ymax=max, ymin=val_df$mean),fill=\"#7FFF7F\")+\n      geom_ribbon(data=neg, aes(group=1,ymax=val_df$mean, ymin=min), fill=\"#FF7F7F\")+\n      geom_rect(aes(xmin=min(df_dat$year),xmax=max(df_dat$year),ymin=val_df$mean-val_df$sd, ymax=val_df$mean+val_df$sd), fill=\"white\")+\n      geom_hline(yintercept=val_df$mean, lty=\"dashed\")+\n      geom_hline(yintercept=val_df$mean+val_df$sd)+\n      geom_hline(yintercept=val_df$mean-val_df$sd)+\n      geom_line(aes(group=1), lwd=1)+\n      labs(x=\"Year\", y=df_lab[2,2], title = df_lab[1,2])+\n      theme_bw() + theme(title = element_text(size=14, face = \"bold\"))\n    \n    if (max(df_dat$year)-min(df_dat$year)&gt;20) {\n      plot_main&lt;-plot_main+scale_x_continuous(breaks = seq(min(df_dat$year),max(df_dat$year),5))\n    } else {\n      plot_main&lt;-plot_main+scale_x_continuous(breaks = seq(min(df_dat$year),max(df_dat$year),2))\n    }\n    plot_main\n    \n  } else {\n    #facet plot\n    \n    plot_sec&lt;-ggplot(data=df_dat, aes(x=year, y=value))+\n      facet_wrap(~subnm, ncol=1, scales = \"free_y\")+\n      geom_ribbon(data=pos, aes(group=subnm,ymax=max, ymin=mean),fill=\"#7FFF7F\")+\n      geom_ribbon(data=neg, aes(group=subnm,ymax=mean, ymin=min), fill=\"#FF7F7F\")+\n      geom_rect(data=merge(df_dat,val_df), aes(xmin=allminyear,xmax=allmaxyear,ymin=mean-sd, ymax=mean+sd), fill=\"white\")+\n      geom_hline(aes(yintercept=mean), lty=\"dashed\",data=val_df)+\n      geom_hline(aes(yintercept=mean+sd),data=val_df)+\n      geom_hline(aes(yintercept=mean-sd),data=val_df)+\n      geom_line(aes(group=1), lwd=0.75)+\n      labs(x=\"Year\", y=df_lab[2,2], title = df_lab[1,2])+\n      theme_bw()+theme(strip.background = element_blank(),\n                       strip.text = element_text(face=\"bold\"),\n                       title = element_text(size=14, face = \"bold\"))\n    \n    if (max(df_dat$year)-min(df_dat$year)&gt;20) {\n      plot_sec&lt;-plot_sec+scale_x_continuous(breaks = seq(min(df_dat$year),max(df_dat$year),5))\n    } else {\n      # plot_sec&lt;-plot_sec+scale_x_continuous(breaks = seq(min(df_dat$year),max(df_dat$year),2))\n    }\n    plot_sec\n    \n  }\n}\n\n\n\nplot_fn_obj&lt;-function(df_obj) {\n  \n  \n  if (ncol(df_obj$data)&lt;5.5){\n    #single plot\n    plot_main&lt;-ggplot(data=df_obj$data, aes(x=year, y=value))+\n      geom_ribbon(data=df_obj$pos, aes(group=1,ymax=max, ymin=df_obj$vals$mean),fill=\"#7FFF7F\")+\n      geom_ribbon(data=df_obj$neg, aes(group=1,ymax=df_obj$vals$mean, ymin=min), fill=\"#FF7F7F\")+\n      geom_rect(aes(xmin=min(df_obj$data$year),xmax=max(df_obj$data$year),ymin=df_obj$vals$mean-df_obj$vals$sd, ymax=df_obj$vals$mean+df_obj$vals$sd), fill=\"white\")+\n      geom_hline(yintercept=df_obj$vals$mean, lty=\"dashed\")+\n      geom_hline(yintercept=df_obj$vals$mean+df_obj$vals$sd)+\n      geom_hline(yintercept=df_obj$vals$mean-df_obj$vals$sd)+\n      geom_line(aes(group=1), lwd=1)+\n      labs(x=\"Year\", y=df_obj$labs[2,2], title = df_obj$labs[1,2])+\n      theme_bw() + theme(title = element_text(size=14, face = \"bold\"))\n    \n    if (max(df_obj$data$year)-min(df_obj$data$year)&gt;20) {\n      plot_main&lt;-plot_main+scale_x_continuous(breaks = seq(min(df_obj$data$year),max(df_obj$data$year),5))\n    } else {\n      plot_main&lt;-plot_main+scale_x_continuous(breaks = seq(min(df_obj$data$year),max(df_obj$data$year),2))\n    }\n    plot_main\n    \n  } else {\n    #facet plot\n    \n    plot_sec&lt;-ggplot(data=df_obj$data, aes(x=year, y=value))+\n      facet_wrap(~subnm, ncol=1, scales = \"free_y\")+\n      geom_ribbon(data=df_obj$pos, aes(group=subnm,ymax=max, ymin=mean),fill=\"#7FFF7F\")+\n      geom_ribbon(data=df_obj$neg, aes(group=subnm,ymax=mean, ymin=min), fill=\"#FF7F7F\")+\n      geom_rect(data=merge(df_obj$data,df_obj$vals), aes(xmin=allminyear,xmax=allmaxyear,ymin=mean-sd, ymax=mean+sd), fill=\"white\")+\n      geom_hline(aes(yintercept=mean), lty=\"dashed\",data=df_obj$vals)+\n      geom_hline(aes(yintercept=mean+sd),data=df_obj$vals)+\n      geom_hline(aes(yintercept=mean-sd),data=df_obj$vals)+\n      geom_line(aes(group=1), lwd=0.75)+\n      labs(x=\"Year\", y=df_obj$labs[2,2], title = df_obj$labs[1,2])+\n      theme_bw()+theme(strip.background = element_blank(),\n                       strip.text = element_text(face=\"bold\"),\n                       title = element_text(size=14, face = \"bold\"))\n    \n    if (max(df_obj$data$year)-min(df_obj$data$year)&gt;20) {\n      plot_sec&lt;-plot_sec+scale_x_continuous(breaks = seq(min(df_obj$data$year),max(df_obj$data$year),5))\n    } else {\n      # plot_sec&lt;-plot_sec+scale_x_continuous(breaks = seq(min(df_obj$data$year),max(df_obj$data$year),2))\n    }\n    plot_sec\n    \n  }\n}\nTest plot from Object\nbrownpeli&lt;-readRDS(\"Peli_Obj.rds\")\n\n\nplot_fn_obj(brownpeli)\n\n\n\n\n\n\n\npeli_new&lt;-data_prep_fn(peli)\n\nplot_fn_obj(peli_new)"
  },
  {
    "objectID": "Data_Obj/App_Prep.html#run-mega-function-on-many-datsets-to-prep-data",
    "href": "Data_Obj/App_Prep.html#run-mega-function-on-many-datsets-to-prep-data",
    "title": "App_Prep",
    "section": "Run Mega function on many datsets to prep data",
    "text": "Run Mega function on many datsets to prep data\n\nMegafunction\n\ndata_prep_fn &lt;-function (df, list_nm) {\n  df_list&lt;-vector(\"list\", 5)\n  names(df_list)&lt;-c(\"data\", \"pos\", \"neg\", \"labs\", \"vals\")\n\n  #Data used for everything\n  df_dat&lt;-df[4:nrow(df),c(1:ncol(df))] \n  \n  if (ncol(df_dat)&lt;2.5) {\n    colnames(df_dat)&lt;-c(\"year\",\"value\")\n    df_dat$value&lt;- as.numeric(df_dat$value)\n    \n    mean&lt;-mean(as.numeric(df_dat$value), na.rm = T)\n    sd&lt;-sd(as.numeric(df_dat$value), na.rm = T)\n    \n    df_dat$valence[df_dat$value&gt;=mean]&lt;-\"pos\"\n    df_dat$valence[df_dat$value&lt; mean]&lt;-\"neg\"\n    df_dat$min &lt;- ifelse(df_dat$value &gt;= mean, mean, df_dat$value)\n    df_dat$max &lt;- ifelse(df_dat$value &gt;= mean, df_dat$value, mean)\n    df_dat$year &lt;- as.numeric(df_dat$year)\n    df_dat} else {\n      \n      sub_list&lt;-list() \n      for (i in 2:ncol(df_dat)){\n        sub_df&lt;-df_dat[,c(1,i)]\n        df_lab&lt;-df[1:3,] #For example sake cutting to only col I need\n        ind&lt;-df_lab[3,]\n        colnames(sub_df)&lt;-c(\"year\",\"value\")\n        # sub_df$value&lt;- as.numeric(sub_df$value)\n        sub_df&lt;-as.data.frame(lapply(sub_df, as.numeric))\n        \n        mean&lt;-mean(as.numeric(sub_df$value), na.rm = T)\n        sd&lt;-sd(as.numeric(sub_df$value), na.rm = T)\n        \n        sub_df$valence[sub_df$value&gt;=mean]&lt;-\"pos\"\n        sub_df$valence[sub_df$value&lt; mean]&lt;-\"neg\"\n        sub_df$min &lt;- ifelse(sub_df$value &gt;= mean, mean, sub_df$value)\n        sub_df$max &lt;- ifelse(sub_df$value &gt;= mean, sub_df$value, mean)\n        sub_df$year &lt;- as.numeric(sub_df$year)\n        sub_df$subnm&lt;-ind[,i]\n        sub_list[[i]]&lt;-sub_df\n        \n      }\n      df_dat&lt;-do.call(\"rbind\",sub_list)\n    }\n  df_list$data&lt;-df_dat\n  \n\n#Pos data set used for main plot\n\n  if(ncol(df_dat)&lt;6){\n    mean&lt;-mean(as.numeric(df_dat$value), na.rm = T)\n    sd&lt;-sd(as.numeric(df_dat$value), na.rm = T)\n    pos&lt;-df_dat\n    pos$value&lt;-ifelse(pos$valence == \"pos\",pos$value, mean)\n    pos} else {\n      sub_list&lt;-list()\n      subs&lt;-unique(df_dat$subnm)\n      for (i in 1:length(subs)){\n        sub_df&lt;-df_dat[df_dat$subnm==subs[i],]\n        mean&lt;-mean(as.numeric(sub_df$value), na.rm = T)\n        sd&lt;-sd(as.numeric(sub_df$value), na.rm = T)\n        pos&lt;-sub_df\n        pos$value&lt;-ifelse(pos$valence == \"pos\",pos$value, mean)\n        pos$subnm&lt;-subs[i]\n        pos$mean&lt;-mean\n        pos$sd&lt;-sd\n        sub_list[[i]]&lt;-pos\n      }\n      pos&lt;-do.call(\"rbind\",sub_list)\n    }\n      df_list$pos&lt;-pos\n\n\n#Neg data set used for main plot\n  if(ncol(df_dat)&lt;6){\n    mean&lt;-mean(as.numeric(df_dat$value), na.rm = T)\n    sd&lt;-sd(as.numeric(df_dat$value), na.rm = T)\n    neg&lt;-df_dat\n    neg$value&lt;-ifelse(neg$valence == \"neg\",neg$value, mean)\n    neg} else {\n      sub_list&lt;-list()\n      subs&lt;-unique(df_dat$subnm)\n      for (i in 1:length(subs)){\n        sub_df&lt;-df_dat[df_dat$subnm==subs[i],]\n        mean&lt;-mean(as.numeric(sub_df$value), na.rm = T)\n        sd&lt;-sd(as.numeric(sub_df$value), na.rm = T)\n        neg&lt;-sub_df\n        neg$value&lt;-ifelse(neg$valence == \"neg\",neg$value, mean)\n        neg$subnm&lt;-subs[i]\n        neg$mean&lt;-mean\n        neg$sd&lt;-sd\n        sub_list[[i]]&lt;-neg\n      }\n      neg&lt;-do.call(\"rbind\",sub_list)\n    }\n      df_list$neg&lt;-neg\n      \ndf_list$labs&lt;-df[1:3, c(1:ncol(df))]\n\n#Independent values used throughout\n  if(ncol(df_dat)&lt;6){\n    mean&lt;-mean(as.numeric(df_dat$value), na.rm = T)\n    sd&lt;-sd(as.numeric(df_dat$value), na.rm = T)\n    \n    #Trend Analysis\n    last5&lt;-df_dat[df_dat$year &gt; max(df_dat$year)-5,]\n    #Mean Trend\n    last5_mean&lt;-mean(last5$value) # mean value last 5 years\n    mean_tr&lt;-if_else(last5_mean&gt;mean+sd, \"ptPlus\", if_else(last5_mean&lt;mean-sd, \"ptMinus\",\"ptSolid\")) #qualify mean trend\n    mean_sym&lt;-if_else(last5_mean&gt;mean+sd, \"+\", if_else(last5_mean&lt;mean-sd, \"-\",\"●\")) #qualify mean trend\n    mean_word&lt;-if_else(last5_mean&gt;mean+sd, \"greater\", if_else(last5_mean&lt;mean-sd, \"below\",\"within\")) #qualify mean trend\n    \n    #Slope Trend\n    lmout&lt;-summary(lm(last5$value~last5$year))\n    last5_slope&lt;-coef(lmout)[2,1] * 5 #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n    slope_tr&lt;-if_else(last5_slope&gt;sd, \"arrowUp\", if_else(last5_slope&lt; c(-sd), \"arrowDown\",\"arrowRight\"))\n    slope_sym&lt;-if_else(last5_slope&gt;sd, \"↑\", if_else(last5_slope&lt; c(-sd), \"↓\",\"→\"))\n    slope_word&lt;-if_else(last5_slope&gt;sd, \"an increasing\", if_else(last5_slope&lt; c(-sd), \"a decreasing\",\"a stable\"))\n    \n    #Dataframe\n    vals&lt;-data.frame(mean=mean,\n                     sd=sd,\n                     mean_tr=mean_tr,\n                     slope_tr=slope_tr,\n                     mean_sym=mean_sym,\n                     slope_sym=slope_sym,\n                     mean_word=mean_word,\n                     slope_word=slope_word)\n    vals} else {\n      sub_list&lt;-list()\n      subs&lt;-unique(df_dat$subnm)\n      for (i in 1:length(subs)){\n        sub_df&lt;-df_dat[df_dat$subnm==subs[i],]\n        minyear&lt;-min(na.omit(sub_df)$year)\n        maxyear&lt;-max(na.omit(sub_df)$year)\n        allminyear&lt;-min(df_dat$year)\n        allmaxyear&lt;-max(df_dat$year)\n        mean&lt;-mean(as.numeric(sub_df$value), na.rm = T)\n        sd&lt;-sd(as.numeric(sub_df$value), na.rm = T)\n        \n        #Trend Analysis\n        last5&lt;-sub_df[sub_df$year &gt; max(sub_df$year)-5,]\n        #Mean Trend\n        last5_mean&lt;-mean(last5$value) # mean value last 5 years\n        mean_tr&lt;-if_else(last5_mean&gt;mean+sd, \"ptPlus\", if_else(last5_mean&lt;mean-sd, \"ptMinus\",\"ptSolid\")) #qualify mean trend\n        mean_sym&lt;-if_else(last5_mean&gt;mean+sd, \"+\", if_else(last5_mean&lt;mean-sd, \"-\",\"●\")) #qualify mean trend\n        mean_word&lt;-if_else(last5_mean&gt;mean+sd, \"greater\", if_else(last5_mean&lt;mean-sd, \"below\",\"within\")) #qualify mean trend\n        \n        #Slope Trend\n        lmout&lt;-summary(lm(last5$value~last5$year))\n        last5_slope&lt;-coef(lmout)[2,1] * 5 #multiply by years in the trend (slope per year * number of years=rise over 5 years)\n        slope_tr&lt;-if_else(last5_slope&gt;sd, \"arrowUp\", if_else(last5_slope&lt; c(-sd), \"arrowDown\",\"arrowRight\"))\n        slope_sym&lt;-if_else(last5_slope&gt;sd, \"↑\", if_else(last5_slope&lt; c(-sd), \"↓\",\"→\"))\n        slope_word&lt;-if_else(last5_slope&gt;sd, \"an increasing\", if_else(last5_slope&lt; c(-sd), \"a decreasing\",\"a stable\"))\n        \n        vals&lt;-data.frame(allminyear=allminyear,\n                         allmaxyear=allmaxyear,\n                         minyear=minyear,\n                         maxyear=maxyear,\n                         mean=mean,\n                         sd=sd,\n                         mean_tr=mean_tr,\n                         slope_tr=slope_tr,\n                         mean_sym=mean_sym,\n                         slope_sym=slope_sym,\n                         mean_word=mean_word,\n                         slope_word=slope_word,\n                         subnm=subs[i])\n        \n        \n        sub_list[[i]]&lt;-vals\n      }\n      vals&lt;-do.call(\"rbind\",sub_list)\n\n    }\n  df_list$vals&lt;-vals\n  df_list\n}\n\n\n\nRun on Datasets\nNeed to add a save=t option and a directory to save the file to\n\nblcrab_li&lt;-data_prep_fn(crab)\nbrpeli_li&lt;-data_prep_fn(peli)\nnav_li&lt;-data_prep_fn(nav)\noilsp_li&lt;-data_prep_fn(oilspill)\noystercat_li&lt;-data_prep_fn(oyster)\npersmbusi_li&lt;-data_prep_fn(sml_bus)\nrdrum_li&lt;-data_prep_fn(red_drum)\nvesfish_li&lt;-data_prep_fn(ves_deal)\n\n#save files\nsaveRDS(blcrab_li, \"blcrab_li.rds\")\nsaveRDS(brpeli_li, \"brpeli_li.rds\")\nsaveRDS(nav_li, \"nav_li.rds\")\nsaveRDS(oilsp_li, \"oilsp_li.rds\")\nsaveRDS(oystercat_li, \"oystercat_li.rds\")\nsaveRDS(persmbusi_li, \"persmbusi_li.rds\")\nsaveRDS(rdrum_li, \"rdrum_li.rds\")\nsaveRDS(vesfish_li, \"vesfish_li.rds\")"
  },
  {
    "objectID": "First_Page.html",
    "href": "First_Page.html",
    "title": "First_Page",
    "section": "",
    "text": "#| standalone: true\n#| viewerHeight: 600\nlibrary(shiny)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(plotly)\n# library(png)\nlibrary(gt)\nlibrary(shinythemes)\nlibrary(cowplot)\nlibrary(gtExtras)  \nlibrary(bslib)\n\n# Define UI for app that draws a histogram ----\nui &lt;- page_sidebar(\n  # App title ----\n  title = \"Hello Shiny!\",\n  # Sidebar panel for inputs ----\n  sidebar = sidebar(\n    # Input: Slider for the number of bins ----\n    sliderInput(\n      inputId = \"bins\",\n      label = \"Number of bins:\",\n      min = 1,\n      max = 50,\n      value = 30\n    )\n  ),\n  # Output: Histogram ----\n  plotOutput(outputId = \"distPlot\", width=\"80%\")\n)\n\nserver &lt;- function(input, output) {\n\n  # Histogram of the Old Faithful Geyser Data ----\n  # with requested number of bins\n  # This expression that generates a histogram is wrapped in a call\n  # to renderPlot to indicate that:\n  #\n  # 1. It is \"reactive\" and therefore should be automatically\n  #    re-executed when inputs (input$bins) change\n  # 2. Its output type is a plot\n  output$distPlot &lt;- renderPlot({\n\n    x    &lt;- faithful$waiting\n    bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)\n\n    hist(x, breaks = bins, col = \"yellow\", border = \"green\",\n         xlab = \"Waiting time to next eruption (in mins)\",\n         main = \"Second app on page?\")\n\n    })\n\n}\n\nshinyApp(ui = ui, server = server)"
  },
  {
    "objectID": "First_Page.html#part-of-old-app",
    "href": "First_Page.html#part-of-old-app",
    "title": "First_Page",
    "section": "",
    "text": "#| standalone: true\n#| viewerHeight: 600\nlibrary(shiny)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(plotly)\n# library(png)\nlibrary(gt)\nlibrary(shinythemes)\nlibrary(cowplot)\nlibrary(gtExtras)  \nlibrary(bslib)\n\n# Define UI for app that draws a histogram ----\nui &lt;- page_sidebar(\n  # App title ----\n  title = \"Hello Shiny!\",\n  # Sidebar panel for inputs ----\n  sidebar = sidebar(\n    # Input: Slider for the number of bins ----\n    sliderInput(\n      inputId = \"bins\",\n      label = \"Number of bins:\",\n      min = 1,\n      max = 50,\n      value = 30\n    )\n  ),\n  # Output: Histogram ----\n  plotOutput(outputId = \"distPlot\", width=\"80%\")\n)\n\nserver &lt;- function(input, output) {\n\n  # Histogram of the Old Faithful Geyser Data ----\n  # with requested number of bins\n  # This expression that generates a histogram is wrapped in a call\n  # to renderPlot to indicate that:\n  #\n  # 1. It is \"reactive\" and therefore should be automatically\n  #    re-executed when inputs (input$bins) change\n  # 2. Its output type is a plot\n  output$distPlot &lt;- renderPlot({\n\n    x    &lt;- faithful$waiting\n    bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)\n\n    hist(x, breaks = bins, col = \"yellow\", border = \"green\",\n         xlab = \"Waiting time to next eruption (in mins)\",\n         main = \"Second app on page?\")\n\n    })\n\n}\n\nshinyApp(ui = ui, server = server)"
  },
  {
    "objectID": "Second_Page.html",
    "href": "Second_Page.html",
    "title": "Second_Page",
    "section": "",
    "text": "#| standalone: true\n#| viewerHeight: 600\nlibrary(shiny)\nlibrary(bslib)\n\n# Define UI for app that draws a histogram ----\nui &lt;- page_sidebar(\n  # App title ----\n  title = \"Hello Shiny!\",\n  # Sidebar panel for inputs ----\n  sidebar = sidebar(\n    # Input: Slider for the number of bins ----\n    sliderInput(\n      inputId = \"bins\",\n      label = \"Number of bins:\",\n      min = 1,\n      max = 50,\n      value = 30\n    )\n  ),\n  # Output: Histogram ----\n  plotOutput(outputId = \"distPlot\", width=\"80%\")\n)\n\nserver &lt;- function(input, output) {\n\n  # Histogram of the Old Faithful Geyser Data ----\n  # with requested number of bins\n  # This expression that generates a histogram is wrapped in a call\n  # to renderPlot to indicate that:\n  #\n  # 1. It is \"reactive\" and therefore should be automatically\n  #    re-executed when inputs (input$bins) change\n  # 2. Its output type is a plot\n  output$distPlot &lt;- renderPlot({\n\n    x    &lt;- faithful$waiting\n    bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)\n\n    hist(x, breaks = bins, col = \"yellow\", border = \"green\",\n         xlab = \"Waiting time to next eruption (in mins)\",\n         main = \"Second app on page?\")\n\n    })\n\n}\n\nshinyApp(ui = ui, server = server)"
  },
  {
    "objectID": "Second_Page.html#app-3",
    "href": "Second_Page.html#app-3",
    "title": "Second_Page",
    "section": "",
    "text": "#| standalone: true\n#| viewerHeight: 600\nlibrary(shiny)\nlibrary(bslib)\n\n# Define UI for app that draws a histogram ----\nui &lt;- page_sidebar(\n  # App title ----\n  title = \"Hello Shiny!\",\n  # Sidebar panel for inputs ----\n  sidebar = sidebar(\n    # Input: Slider for the number of bins ----\n    sliderInput(\n      inputId = \"bins\",\n      label = \"Number of bins:\",\n      min = 1,\n      max = 50,\n      value = 30\n    )\n  ),\n  # Output: Histogram ----\n  plotOutput(outputId = \"distPlot\", width=\"80%\")\n)\n\nserver &lt;- function(input, output) {\n\n  # Histogram of the Old Faithful Geyser Data ----\n  # with requested number of bins\n  # This expression that generates a histogram is wrapped in a call\n  # to renderPlot to indicate that:\n  #\n  # 1. It is \"reactive\" and therefore should be automatically\n  #    re-executed when inputs (input$bins) change\n  # 2. Its output type is a plot\n  output$distPlot &lt;- renderPlot({\n\n    x    &lt;- faithful$waiting\n    bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)\n\n    hist(x, breaks = bins, col = \"yellow\", border = \"green\",\n         xlab = \"Waiting time to next eruption (in mins)\",\n         main = \"Second app on page?\")\n\n    })\n\n}\n\nshinyApp(ui = ui, server = server)"
  }
]